<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Streamlining Detection Development with Goose Recipes | goose</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="description" content="A comprehensive guide to using recipes in Goose to streamline security detection development"><meta data-rh="true" property="article:published_time" content="2025-07-28T00:00:00.000Z"><meta data-rh="true" property="og:title" content="Streamlining Detection Development with Goose Recipes"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="og:url" content="https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes"><meta data-rh="true" property="og:description" content="A comprehensive guide to using recipes in Goose to streamline security detection development"><meta data-rh="true" property="og:image" content="https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover.png"><meta data-rh="true" property="og:image" content="https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png"><meta data-rh="true" property="twitter:domain" content="block.github.io/goose"><meta data-rh="true" name="twitter:title" content="Streamlining Detection Development with Goose Recipes"><meta data-rh="true" name="twitter:description" content="A comprehensive guide to using recipes in Goose to streamline security detection development"><meta data-rh="true" name="twitter:image" content="https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover.png"><meta data-rh="true" name="twitter:image" content="https://block.github.io/goose/assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png"><link data-rh="true" rel="icon" href="/goose/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes"><link data-rh="true" rel="alternate" href="https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes" hreflang="en"><link data-rh="true" rel="alternate" href="https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes","mainEntityOfPage":"https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes","url":"https://block.github.io/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes","headline":"Streamlining Detection Development with Goose Recipes","name":"Streamlining Detection Development with Goose Recipes","description":"A comprehensive guide to using recipes in Goose to streamline security detection development","datePublished":"2025-07-28T00:00:00.000Z","author":{"@type":"Person","name":"Glenn Edwards","description":"Detection Engineer","image":"https://avatars.githubusercontent.com/u/1418309?v=4"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://block.github.io/goose/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/goose/blog/rss.xml" title="goose RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/goose/blog/atom.xml" title="goose Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZS5D6SB4ZJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZS5D6SB4ZJ",{anonymize_ip:!0})</script>









<link rel="alternate" type="text/plain" title="LLM context" href="/goose/llms.txt"><link rel="stylesheet" href="/goose/assets/css/styles.55a7d422.css">
<script src="/goose/assets/js/runtime~main.ce4b0899.js" defer="defer"></script>
<script src="/goose/assets/js/main.83a81719.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/goose/img/logo_light.png"><link rel="preload" as="image" href="/goose/img/logo_dark.png"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/1418309?v=4"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/goose/"><div class="navbar__logo"><img src="/goose/img/logo_light.png" alt="Block Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/goose/img/logo_dark.png" alt="Block Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/goose/docs/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/goose/docs/category/guides">Docs</a><a class="navbar__item navbar__link" href="/goose/docs/category/tutorials">Tutorials</a><a class="navbar__item navbar__link" href="/goose/docs/category/mcp-servers">MCPs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/goose/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/goose/extensions">Extensions</a></li><li><a class="dropdown__link" href="/goose/recipe-generator">Recipe Generator</a></li><li><a class="dropdown__link" href="/goose/prompt-library">Prompt Library</a></li><li><a class="dropdown__link" href="/goose/recipes">Recipe Cookbook</a></li><li><a class="dropdown__link" href="/goose/deeplink-generator">Deeplink Generator</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://discord.gg/goose-oss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/block/goose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="inkeep"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2026/01/06/mcp-apps">goose Lands MCP Apps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2026/01/05/agentic-guardrails-and-controls">Agent Guardrails and Controls: Applying the CORS Model to Agents</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2026/01/04/how-i-taught-my-agent-my-design-taste">How I Taught My Agent My Design Taste</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/28/goose-maintains-goose">How We Use goose to Maintain goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/22/agent-skills-vs-mcp">Did Skills Kill MCP?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/21/code-mode-doesnt-replace-mcp">Code Mode Doesn&#x27;t Replace MCP (Here&#x27;s What It Actually Does)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/19/does-your-ai-agent-need-a-plan">Does Your AI Agent Need a Plan?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/19/goose-mobile-terminal">goose Mobile Access and Native Terminal Support</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/15/code-mode-mcp">Code Mode MCP in goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/10/stop-ai-agent-unwanted-changes">How to Stop Your AI Agent From Making Unwanted Code Changes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/12/04/mcp-sampling">MCP Sampling: When Your Tools Need to Think</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/11/30/announcing-advent-of-ai">Announcing Advent of AI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/11/26/mcp-for-devs">MCPs for Developers Who Think They Don&#x27;t Need MCPs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/11/21/social-media-agent-automation">Building a Social Media Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/11/17/migrate-app-with-ai-agent">How to Successfully Migrate Your App with an AI Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/10/24/intro-to-agent-client-protocol-acp">Intro to Agent Client Protocol (ACP): The Standard for AI Agent-Editor Integration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/10/14/designing-ai-for-humans">Designing AI for Users, Not Just LLMs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/10/08/recipe-cookbook-generator">Build Your Own Recipe Cookbook Generator for goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/09/26/hacktoberfest-2025">goose is Celebrating Hacktoberfest 2025!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/09/26/subagents-vs-subrecipes">How to Choose Between Subagents and Subrecipes in goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/09/15/subrecipes-in-goose">Automate Your Complex Workflows with Subrecipes in goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/09/08/turn-any-mcp-server-mcp-ui-compatible">How to Make An MCP Server MCP-UI Compatible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/28/ai-teammate">When AI Becomes Your New Team Member: The Story of Goose Janitor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/27/autovisualiser-with-mcp-ui">Auto Visualiser with MCP-UI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/27/get-started-for-free-with-tetrate">Your First goose Experience Is On Us</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/25/goose-became-its-own-watchdog">I had Goose Build its Own Secure Recipe Scanner</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/25/mcp-ui-future-agentic-interfaces">MCP-UI: The Future of Agentic Interfaces</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/18/transforming-ai-assistance-goose-mentor-mode">Transforming AI Assistance from Automation to Education: The Story Behind Goose Mentor Mode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/18/understanding-context-windows">The AI Skeptic‚Äôs Guide to Context Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/14/agent-coordination-patterns">Agents, Subagents, and Multi Agents: What They Are and When to Use Them</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/14/how-goose-rebuilt-my-website">How I Used Goose to Rebuild My Website</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/13/pulse-mcp-automates-recipe">How PulseMCP Automated Their Newsletter Workflow with Goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/12/mcp-testing">Automated MCP Testing: Using Composable Goose Recipes to Validate Tool Metadata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/11/llm-tag-team-lead-worker-model">LLM Tag Team: Who Plans, Who Executes?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/11/mcp-ui-post-browser-world">MCP UI: Bringing the Browser into the Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/10/vibe-coding-with-goose-building-apps-with-ai-agents">How 7 AI Agents Worked Together to Build an App in One Hour</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/08/04/mcp-jupyter-server">MCP Jupyter: AI-Powered Machine Learning and Data Science</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/07/29/openrouter-unlocks-workshops">How OpenRouter Unlocked Our Workshop Strategy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/07/28/ai-to-ai">When AI Meets AI: Goose Desktop and CLI Collaborate</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/goose/blog/2025/07/28/streamlining-detection-development-with-goose-recipes">Streamlining Detection Development with Goose Recipes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/07/21/orchestrating-subagents">Orchestrating 6 Subagents to Build a Collaborative API Playground for Kids</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/27/everyday-usecases-ai">5 Boring Tasks I Gave to My AI Agent Today (That Saved Me Hours)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/19/isolated-development-environments">Isolated Dev Environments in Goose with container-use</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/17/goose-emotion-detection-app">Why I Used Goose to Build a Chaotic Emotion Detection App</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/16/multi-model-in-goose">Treating LLMs Like Tools in a Toolbox: A Multi-Model Approach to Smarter AI Agents</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/05/whats-in-my-goosehints-file">What&#x27;s in my .goosehints file (and why it probably shouldn&#x27;t be)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/06/02/goose-panther-mcp">Democratizing Detection Engineering at Block: Taking Flight with Goose and Panther MCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/22/llm-agent-readiness">3 Prompts to Test for Agent Readiness</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/22/manage-local-host-conflicts-with-goose">How I Manage Localhost Port Conflicts With an AI Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/20/goose-gets-a-drivers-license">Goose Gets a Driver&#x27;s License!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/12/local-goose-qwen3">Goose and Qwen3 for Local Execution</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/09/developers-ai-playbook-for-team-efficiency">Championship Driven Development: Your Team&#x27;s AI Playbook for Peak Performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/05/06/recipe-for-success">A Recipe for Success: Cooking Up Repeatable Agentic Workflows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/23/things-need-to-know">4 Things You Need to Know Before Using Goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/22/community-bestcodes">How One Contribution Can Spark Many Wins</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/22/mcp-is-rewriting-the-rules-of-api-integration">MCP Is Rewriting the Rules of API Integration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/21/mcp-in-enterprise">MCP in the Enterprise: Real World Adoption at Block</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/21/practical-use-cases-of-ai">11 Practical Ways I Use AI Agents Without Losing My Authenticity</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/17/goose-goes-to-NY">Codename Goose Goes to New York</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/14/community-atruelight4">How ATrueLight4 Helped Goose Navigate Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/11/finetuning-toolshim">Finetuning Toolshim Models for Tool Calling</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/10/visual-guide-mcp">A Visual Guide To MCP Ecosystem</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/08/vibe-code-responsibly">How to Vibe Code Responsibly (with Goose)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/01/top-5-mcp-servers">Top 5 MCP Servers I Use as a Developer with Goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/04/01/mcp-nondevs">MCP Explained for Non-Developers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/31/goose-benchmark">Community-Inspired Benchmarking: The Goose Vibe Check</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/31/securing-mcp">Securing the Model Context Protocol</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/28/vibe-coding-with-goose">Vibe Coding with Goose and the Speech MCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/26/mcp-security">How to Determine If An MCP Server Is Safe</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/21/goose-boston-meetup">Codename Goose Goes to Boston</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/21/goose-vscode">Cracking the Code with VS Code MCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/20/asana-calendar-mcp">How I Use goose to Plan My Week with Asana and Google Calendar MCPs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/19/better-ai-prompting">AI Prompting 101: How to Get the Best Responses from Your AI Agent</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/18/goose-langfuse">How goose Catches AI Errors with Langfuse</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/14/goose-ollama">AI, But Make It Local With goose and Ollama</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/12/goose-figma-mcp">Turn Figma Designs Into Code With goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/10/goose-calls-vyop">Automating Phone Calls with goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/03/06/goose-tips">6 Essential Tips for Working with goose</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/02/21/gooseteam-mcp">Let A Team of AI Agents Do It For You</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/02/17/agentic-ai-mcp">Agentic AI and the MCP Ecosystem</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2025/01/28/introducing-codename-goose">Introducing codename goose</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2024/12/11/resolving-ci-issues-with-goose-a-practical-walkthrough">Resolving CI Issues with goose: A Practical Walkthrough</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2024/12/10/connecting-ai-agents-to-your-systems-with-mcp">Connecting AI Agents to Your Systems with MCP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2024/12/06/previewing-goose-v10-beta">Previewing goose v1.0 Beta</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/goose/blog/2024/11/22/screenshot-driven-development">Screenshot-Driven Development</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Streamlining Detection Development with Goose Recipes</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-07-28T00:00:00.000Z">July 28, 2025</time> ¬∑ <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/goose/blog/authors/glenn"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/1418309?v=4" alt="Glenn Edwards"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/goose/blog/authors/glenn"><span class="authorName_yefp" translate="no">Glenn Edwards</span></a></div><small class="authorTitle_nd0D" title="Detection Engineer">Detection Engineer</small><div class="authorSocials_rSDt"><a href="https://www.linkedin.com/in/glennpedwardsjr/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" style="--dark:#0a66c2;--light:#ffffffe6" class="authorSocialIcon_XYv3 linkedinSvg_FCgI"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"></path></svg></a><a href="https://github.com/hiddenillusion" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://x.com/hiddenillusion" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://bsky.app/profile/hiddenillusion" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="Bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 226" style="--dark:#0085ff;--light:#0085ff" class="authorSocialIcon_XYv3 blueskySvg_AzZw"><path d="M55.491 15.172c29.35 22.035 60.917 66.712 72.509 90.686 11.592-23.974 43.159-68.651 72.509-90.686C221.686-.727 256-13.028 256 26.116c0 7.818-4.482 65.674-7.111 75.068-9.138 32.654-42.436 40.983-72.057 35.942 51.775 8.812 64.946 38 36.501 67.187-54.021 55.433-77.644-13.908-83.696-31.676-1.11-3.257-1.63-4.78-1.637-3.485-.008-1.296-.527.228-1.637 3.485-6.052 17.768-29.675 87.11-83.696 31.676-28.445-29.187-15.274-58.375 36.5-67.187-29.62 5.041-62.918-3.288-72.056-35.942C4.482 91.79 0 33.934 0 26.116 0-13.028 34.314-.727 55.491 15.172Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" alt="blog cover" src="/goose/assets/images/goose-recipes-detection-development-cover-cac8a9bea2d090ec2758a0b907bc9da8.png" width="1536" height="1024" class="img_ev3q"></p>
<p>Creating effective security detections in Panther traditionally requires deep knowledge of detection logic, testing frameworks, and development workflows. The detection engineering team at Block has streamlined this process by building Goose recipes that automate the entire detection creation lifecycle from initial repository setup to pull request creation.</p>
<p>This blog post explores how to leverage Goose&#x27;s <a href="https://block.github.io/goose/docs/guides/recipes/" target="_blank" rel="noopener noreferrer" class="">recipe</a> and <a href="https://block.github.io/goose/docs/guides/recipes/subrecipes" target="_blank" rel="noopener noreferrer" class="">subrecipe</a> system to create new detections in Panther with minimal manual intervention, ensuring consistency, quality, and adherence to team standards.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-are-recipes">What Are Recipes?<a href="#what-are-recipes" class="hash-link" aria-label="Direct link to What Are Recipes?" title="Direct link to What Are Recipes?" translate="no">‚Äã</a></h2>
<p>Recipes are reusable, shareable configurations that package up a complete setup for a specific task. These standalone files can be used in automation workflows that orchestrate complex tasks by breaking them into manageable, specialized components. Think of them as sophisticated CI/CD pipelines for AI-assisted development, where each step has clearly defined inputs, outputs, and responsibilities.</p>
<p>Two notable ingredients of recipes are <code>instructions</code> and <code>prompt</code>. In short:</p>
<ul>
<li class="">Instructions get added to the system prompt and defines the agent‚Äôs roles and capabilities (influences the AI&#x27;s behavior and personality)</li>
<li class="">The prompt becomes the initial user message with a specific task (starts the conversation)</li>
</ul>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><p>Snippet from <code>workflow_setup</code> showing the difference</p></summary><div><div class="collapsibleContent_i85q"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">instructions: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Create a Panther detection rule that detects: {{ rule_description }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Use the following context:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Similar rules found: {{ similar_rules_found }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Rule analysis: {{ rule_analysis }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Log schemas: {{ log_schemas }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Standards summary: {{ standards_summary }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  **SCOPE BOUNDARIES:**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompt: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ## Process:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1. **Rule Planning**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Follow &quot;üìù Create Rule Files&quot; guidance from `AGENTS.md`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Use streaming rule type (default) unless otherwise specified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - Choose appropriate log source and severity level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2. **File Creation**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  5. **Test Cases**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  7. **üõë STOP CONDITION**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ## ‚úÖ SUCCESS CRITERIA:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - ...</span><br></span></code></pre></div></div></div></div></details>
<p>The detection creation recipe demonstrates the power of this approach by coordinating six specialized subrecipes, each handling a specific aspect of detection development:</p>
<ol>
<li class=""><a href="#1-workflow_setup-foundation-first" class=""><strong>workflow_setup</strong></a> - Repository preparation and environment validation</li>
<li class=""><a href="#2-similar_rule_analyzer-learning-from-existing-patterns" class=""><strong>similar_rule_analyzer</strong></a> - Finding and analyzing existing detection patterns</li>
<li class=""><a href="#3-schema_and_sample_events_analyzer-data-driven-detection-logic" class=""><strong>schema_and_sample_events_analyzer</strong></a> - Analyzing log schemas and performing sample data collection</li>
<li class=""><a href="#4-rule_creator-the-implementation-engine" class=""><strong>rule_creator</strong></a> - Actual detection rule implementation</li>
<li class=""><a href="#5-testing_validator-quality-assurance" class=""><strong>testing_validator</strong></a> - Comprehensive test execution and validation</li>
<li class=""><a href="#6-pr_creator-automated-pull-request-pipeline" class=""><strong>pr_creator</strong></a> - Pull request creation with proper formatting</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-about-goosehints">What about .goosehints?<a href="#what-about-goosehints" class="hash-link" aria-label="Direct link to What about .goosehints?" title="Direct link to What about .goosehints?" translate="no">‚Äã</a></h3>
<p>In our <a href="https://block.github.io/goose/blog/2025/06/02/goose-panther-mcp" target="_blank" rel="noopener noreferrer" class="">previous post</a>, we discussed using <a class="" href="/goose/docs/guides/context-engineering/using-goosehints/">.goosehints</a> to provide persistent context to the Large Language Model (LLM). We continue to use <code>.goosehints</code> to define coding standards and universal preferences that guide LLM behavior.</p>
<p>However, to minimize redundancy and avoid conflicting guidance, we adopted a single reference file, <code>AGENTS.md</code>, as the source of truth for all agents. Each agent is directed to consult this file, while still supporting agent-specific instructions through their default context files (e.g. <code>.goosehints</code>, <code>CLAUDE.md</code> etc.) or rules (e.g. <code>.cursor/rules/</code>).</p>
<p>While these context files are important, they also come with some trade offs and limitations:</p>
<table><thead><tr><th>Aspect</th><th>Context Files</th><th>Recipes</th></tr></thead><tbody><tr><td><strong>Context window pollution</strong></td><td>The entire file is sent with each request, cluttering the context window</td><td>Only task-relevant instructions, keeping prompts clear and focused</td></tr><tr><td><strong>Signal-to-noise ratio</strong></td><td>General preferences dilute focus and may create conflicting guidance</td><td>Every instruction is workflow-specific, eliminating noise</td></tr><tr><td><strong>Cost and performance impact</strong></td><td>May lead to higher token costs and slower processing from unnecessary context</td><td>Pay only for relevant tokens with faster response times</td></tr><tr><td><strong>Cognitive load on the AI</strong></td><td>Conflicting instructions cause decision paralysis</td><td>Clear, unified guidance enables decisive action</td></tr><tr><td><strong>Task-specific optimization</strong></td><td>Generic instructions lack specialized tools and parameters</td><td>Purpose-built with pre-configured tools for specific workflows</td></tr></tbody></table>
<p>This centralized approach through <code>AGENTS.md</code> becomes the foundation for our recipe architecture, which we&#x27;ll explore next.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-architecture">The Architecture<a href="#the-architecture" class="hash-link" aria-label="Direct link to The Architecture" title="Direct link to The Architecture" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="design-principles">Design Principles<a href="#design-principles" class="hash-link" aria-label="Direct link to Design Principles" title="Direct link to Design Principles" translate="no">‚Äã</a></h3>
<ol>
<li class=""><strong>Single Responsibility</strong>: Each subrecipe has one clear job</li>
<li class=""><strong>Explicit Data Flow</strong>: No hidden state or implicit dependencies</li>
<li class=""><strong>Fail-Fast</strong>: Stop immediately when critical steps fail</li>
<li class=""><strong>Graceful Degradation</strong>: Continue with reduced functionality when possible</li>
<li class=""><strong>Comprehensive Testing</strong>: Validate everything before deployment</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-subrecipes-matter">Why Subrecipes Matter<a href="#why-subrecipes-matter" class="hash-link" aria-label="Direct link to Why Subrecipes Matter" title="Direct link to Why Subrecipes Matter" translate="no">‚Äã</a></h3>
<p>The traditional approach to AI-assisted detection creation often involves a single, monolithic prompt (AKA ‚Äúsingle-shot prompting‚Äù) that tries to handle everything at once. This leads to several problems:</p>
<ul>
<li class=""><strong>Context confusion</strong>: The AI loses focus when juggling multiple responsibilities</li>
<li class=""><strong>Inconsistent outputs</strong>: Without clear boundaries, results vary significantly (e.g. one subrecipe may try to complete the task that we&#x27;re expecting another subrecipe to accomplish)</li>
<li class=""><strong>Difficult debugging</strong>: When something fails, it&#x27;s hard to identify the specific issue</li>
<li class=""><strong>Poor maintainability</strong>: Changes to one aspect affect the entire workflow</li>
</ul>
<p>The subrecipe architecture solves these problems through strict separation of concerns, setting boundaries and providing exit criteria.</p>
<p>Each subrecipe operates in isolation with:</p>
<ul>
<li class="">Clearly defined inputs and outputs</li>
<li class="">Specific scope boundaries (what it MUST and MUST NOT do)</li>
<li class="">Standardized JSON response schemas</li>
<li class="">Formal error handling patterns</li>
</ul>
<p>At a high level, a (non-parallel) version would look like:</p>
<table><thead><tr><th>Step</th><th>Component</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><strong>1</strong></td><td><a href="#1-workflow_setup-foundation-first" class=""><code>workflow_setup</code></a></td><td>Required</td><td>Initialize workflow environment</td></tr><tr><td><strong>2</strong></td><td><a href="#2-similar_rule_analyzer-learning-from-existing-patterns" class=""><code>similar_rule_analyzer</code></a></td><td><em>Conditional</em></td><td>Analyze existing similar rules</td></tr><tr><td><strong>3</strong></td><td><a href="#3-schema_and_sample_events_analyzer-data-driven-detection-logic" class=""><code>schema_and_sample_events_analyzer</code></a></td><td><em>Conditional</em></td><td>Process schema and sample data</td></tr><tr><td><strong>4</strong></td><td><a href="#4-rule_creator-the-implementation-engine" class=""><code>rule_creator</code></a></td><td>Required</td><td>Generate the detection rule</td></tr><tr><td><strong>5</strong></td><td><a href="#5-testing_validator-quality-assurance" class=""><code>testing_validator</code></a></td><td>Required</td><td>Validate and test the rule</td></tr><tr><td><strong>6</strong></td><td><a href="#6-pr_creator-automated-pull-request-pipeline" class=""><code>pr_creator</code></a></td><td><em>Conditional</em></td><td>Create pull request</td></tr></tbody></table>
<blockquote>
<p>üí° <strong>Note:</strong> <em>Conditional</em> steps may be skipped based on workflow configuration</p>
</blockquote>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><p>Workflow visualized</p></summary><div><div class="collapsibleContent_i85q"><p><img decoding="async" loading="lazy" alt="workflow_diagram" src="/goose/assets/images/workflow_diagram-178659b4e6b593f9bbfe1f09df21fcc2.png" width="507" height="1294" class="img_ev3q"></p></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-flow-and-state-management">Data Flow and State Management<a href="#data-flow-and-state-management" class="hash-link" aria-label="Direct link to Data Flow and State Management" title="Direct link to Data Flow and State Management" translate="no">‚Äã</a></h2>
<p>Since subrecipes currently run in isolation, data must be explicitly passed between them. The main recipe orchestrates this flow:</p>
<p>Example of how this would be defined in the recipe:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">`workflow_setup(rule_description)` ‚Üí Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - **branch_name**: Name of the created feature branch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - **standards_summary**: Key standards and requirements from `AGENTS.md`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - **repo_ready**: Boolean indicating if repository is ready for development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - **mcp_panther**: Object containing Panther MCP access test results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - **access_test_successful**: Boolean indicating if Panther MCP access test was successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - **error_message**: Error message if access test failed</span><br></span></code></pre></div></div>
<p>And an example of how the data would flow:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">workflow_setup(rule_description) ‚Üí {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  branch_name: &quot;ai/aws-privilege-escalation&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  standards_summary: &quot;Key requirements from AGENTS.md...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repo_ready: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mcp_panther: { access_test_successful: true }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">similar_rule_analyzer(rule_description, standards_summary) ‚Üí {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  similar_rules_found: [...],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rule_analysis: &quot;Analysis of existing patterns...&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  suggested_approach: &quot;Create new rule with modifications...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This explicit data passing ensures:</p>
<ul>
<li class=""><strong>Predictable behavior</strong> across runs</li>
<li class=""><strong>Easy debugging</strong> when issues occur</li>
<li class=""><strong>Clear audit trails</strong> of what data influenced each decision</li>
<li class=""><strong>Modular testing</strong> of individual components</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="smart-optimizations-conditional-execution">Smart Optimizations: Conditional Execution<a href="#smart-optimizations-conditional-execution" class="hash-link" aria-label="Direct link to Smart Optimizations: Conditional Execution" title="Direct link to Smart Optimizations: Conditional Execution" translate="no">‚Äã</a></h2>
<p>One of the most powerful features of the detection creation workflow is its intelligent optimization system that skips unnecessary steps based on both parameters and runtime conditions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parameter-based-conditions">Parameter-Based Conditions<a href="#parameter-based-conditions" class="hash-link" aria-label="Direct link to Parameter-Based Conditions" title="Direct link to Parameter-Based Conditions" translate="no">‚Äã</a></h3>
<p>Users can control workflow behavior through parameters:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Fast mode - skip similar rule analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose run --recipe recipe.yaml --params skip_similar_rules_check=true --rule_description=&quot;What you want to detect&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Skip Panther MCP integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose run --recipe recipe.yaml --params skip_panther_mcp=true --rule_description=&quot;What you want to detect&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create PR automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose run --recipe recipe.yaml --params create_pr=true --rule_description=&quot;What you want to detect&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-conditions">Runtime Conditions<a href="#runtime-conditions" class="hash-link" aria-label="Direct link to Runtime Conditions" title="Direct link to Runtime Conditions" translate="no">‚Äã</a></h3>
<p>The workflow makes intelligent decisions based on results from previous steps:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Current implementation uses both parameter-based and runtime conditions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Parameter-based (available at recipe start):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- skip_similar_rules_check: Controls similar_rule_analyzer execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- skip_panther_mcp: Controls schema_and_sample_events_analyzer execution  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- create_pr: Controls pr_creator execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Runtime conditions (based on subrecipe results):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- schema_and_sample_events_analyzer runs only if:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  * skip_panther_mcp is false AND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  * (similar_rules_found is empty OR mcp_panther.access_test_successful is false)</span><br></span></code></pre></div></div>
<p>This hybrid approach provides:</p>
<ul>
<li class=""><strong>Efficiency</strong>: Avoid redundant API calls when similar rules provide sufficient context</li>
<li class=""><strong>Reliability</strong>: Graceful degradation when external services are unavailable</li>
<li class=""><strong>Flexibility</strong>: Users can choose their preferred speed vs. thoroughness trade-off</li>
</ul>
<p>Additionally, Jinja support enables the codification of event triggers, ensuring the agent adheres to predefined instructions rather than making independent, potentially incorrect, decisions. For instance, the agent can be directed to bypass a step, depending on a parameter&#x27;s value:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{% if create_pr %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. `pr_creator(rule_files_created, rule_description, branch_name, create_pr={{ create_pr }}, panther_mcp_usage)` ‚Üí Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;success&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;pr_created&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;pr_url&quot;: &quot;https://github.com/&lt;org&gt;/&lt;team&gt;-panther-content/pull/123&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;pr_number&quot;: 123,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;summary&quot;: &quot;Summary of the completed work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% else %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. **SKIPPED** `pr_creator` - create_pr parameter is false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - Provide final summary of completed work instead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endif %}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deep-dive-key-subrecipes">Deep Dive: Key Subrecipes<a href="#deep-dive-key-subrecipes" class="hash-link" aria-label="Direct link to Deep Dive: Key Subrecipes" title="Direct link to Deep Dive: Key Subrecipes" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-workflow_setup-foundation-first">1. <code>workflow_setup</code>: Foundation First<a href="#1-workflow_setup-foundation-first" class="hash-link" aria-label="Direct link to 1-workflow_setup-foundation-first" title="Direct link to 1-workflow_setup-foundation-first" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_description</code></td><td><code>branch_name</code>, <code>standards_summary</code>, <code>repo_ready</code>, <code>mcp_panther</code></td></tr></tbody></table>
<p>This subrecipe handles all the foundational work:</p>
<p><strong>Key responsibilities</strong>:</p>
<ul>
<li class="">Repository access verification</li>
<li class="">Git branch creation and management</li>
<li class="">Standards extraction from <code>AGENTS.md</code></li>
<li class="">Environment validation</li>
<li class="">Panther MCP access testing</li>
</ul>
<p><strong>Output example</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;branch_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ai/okta-suspicious-login&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;standards_summary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Rules must use ai_ prefix, implement required functions...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;repo_ready&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;mcp_panther&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;access_test_successful&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-similar_rule_analyzer-learning-from-existing-patterns">2. <code>similar_rule_analyzer</code>: Learning from Existing Patterns<a href="#2-similar_rule_analyzer-learning-from-existing-patterns" class="hash-link" aria-label="Direct link to 2-similar_rule_analyzer-learning-from-existing-patterns" title="Direct link to 2-similar_rule_analyzer-learning-from-existing-patterns" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_description</code>, <code>standards_summary</code>, <code>rule_type</code></td><td><code>similar_rules_found</code>, <code>rule_analysis</code>, <code>suggested_approach</code></td></tr></tbody></table>
<p>This subrecipe searches the repository for similar detection patterns:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Search strategy by rule type:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- streaming rules: Search rules/&lt;team&gt;_rules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- correlation rules: Search correlation_rules/&lt;team&gt;_correlation_rules/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- scheduled rules: Search queries/&lt;team&gt;_queries/</span><br></span></code></pre></div></div>
<p><strong>Key responsibilities</strong>:</p>
<ul>
<li class="">Search for existing rules with similar log sources and detection logic</li>
<li class="">Prioritize team-created rules over upstream patterns</li>
<li class="">Analyze implementation approaches and coding patterns</li>
<li class="">Provide recommendations for new rule development</li>
<li class="">Extract relevant context from similar implementations</li>
</ul>
<p><strong>Key insight</strong>: It prioritizes team-created rules (&lt;team&gt;_* directories) over upstream rules, ensuring consistency with established patterns.</p>
<p>Even without direct access to the detection engine, users can develop new detections by leveraging existing ones, along with our established standards and test suite.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-schema_and_sample_events_analyzer-data-driven-detection-logic">3. <code>schema_and_sample_events_analyzer</code>: Data-Driven Detection Logic<a href="#3-schema_and_sample_events_analyzer-data-driven-detection-logic" class="hash-link" aria-label="Direct link to 3-schema_and_sample_events_analyzer-data-driven-detection-logic" title="Direct link to 3-schema_and_sample_events_analyzer-data-driven-detection-logic" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_description</code>, <code>similar_rules_found</code></td><td><code>log_schemas</code>, <code>example_logs</code>, <code>field_mapping</code>, <code>panther_mcp_usage</code></td></tr></tbody></table>
<p>This subrecipe bridges the gap between detection requirements and implementation by leveraging Panther&#x27;s MCP integration:</p>
<p><strong>Key responsibilities</strong>:</p>
<ul>
<li class="">Log schema analysis using Panther MCP</li>
<li class="">Sample event collection from data lakes</li>
<li class="">Field mapping for detection logic</li>
<li class="">Snowflake SQL query optimization</li>
</ul>
<p><strong>Smart data collection strategy</strong>:</p>
<ul>
<li class=""><em>Parallel execution</em>: Runs multiple Snowflake queries simultaneously rather than sequentially</li>
<li class=""><em>Query planning</em>: Identifies all needed queries before execution to maximize efficiency</li>
<li class=""><em>Progressive sampling</em>: Starts with small result sets (LIMIT 5), scales up as needed</li>
<li class=""><em>Critical boundaries</em>: It explicitly cannot create rule files or run tests - its sole focus is understanding the data structure.</li>
</ul>
<p><strong>Output example</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;log_schemas&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;log_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AWS.CloudTrail&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;schema_summary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Contains eventName, sourceIPAddress, userIdentity fields&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;relevance&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Essential for detecting privilege escalation patterns&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;example_logs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;log_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AWS.CloudTrail&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;event_summary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AssumeRole events with cross-account access&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;key_fields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;eventName&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sourceIPAddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;userIdentity.type&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;panther_mcp_usage&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;mcp_used&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;log_schemas_referenced&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;data_lake_queries_performed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><em>Fallback handling</em>: When Panther MCP is unavailable, it intelligently uses similar rule analysis to infer schema structure, ensuring the workflow continues with reduced but functional capability.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-rule_creator-the-implementation-engine">4. <code>rule_creator</code>: The Implementation Engine<a href="#4-rule_creator-the-implementation-engine" class="hash-link" aria-label="Direct link to 4-rule_creator-the-implementation-engine" title="Direct link to 4-rule_creator-the-implementation-engine" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_description</code>, <code>similar_rules_found</code>, <code>rule_analysis</code>, <code>log_schemas</code>, <code>standards_summary</code></td><td><code>rule_files_created</code>, <code>rule_implementation</code>, <code>test_cases_created</code></td></tr></tbody></table>
<p>This is where the magic happens - this subrecipe generates the required files containing the detection logic, metadata and unit tests.</p>
<p><strong>Smart log source validation</strong>:</p>
<ul>
<li class="">If schema analysis ran successfully ‚Üí Use validated log types</li>
<li class="">If schema analysis was skipped ‚Üí Validate against known log types defined in pytests.</li>
</ul>
<p><strong>Example key principles</strong>:</p>
<ul>
<li class="">Always use default values for event fields</li>
<li class="">Use case-insensitive matching for user-controlled fields</li>
<li class="">Structure logic clearly with grouped conditions</li>
<li class="">Prefer <code>any()</code> and <code>all()</code> over multiple return statements</li>
</ul>
<p>To illustrate, the following example provides guidance for the last bullet point:</p>
<blockquote>
<p>üí° <strong>Code Quality Tip: Simplify Conditional Logic</strong></p>
<p>‚ùå Avoid: Too Many Return Statements</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># multiple returns make logic hard to follow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;eventType&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user.session.start&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;outcome&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SUCCESS&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;actor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alternateId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> TARGET_USER</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><br></span></code></pre></div></div>
<p>‚úÖ Preferred: Clear Structure with <code>any()</code> and <code>all()</code></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;eventType&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user.session.start&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;outcome&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SUCCESS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deep_get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;actor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alternateId&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> TARGET_USER</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-testing_validator-quality-assurance">5. <code>testing_validator</code>: Quality Assurance<a href="#5-testing_validator-quality-assurance" class="hash-link" aria-label="Direct link to 5-testing_validator-quality-assurance" title="Direct link to 5-testing_validator-quality-assurance" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_files_created</code></td><td><code>test_results</code>, <code>validation_status</code>, <code>issues_found</code></td></tr></tbody></table>
<p>This subrecipe serves as the critical quality gate, executing the mandatory testing pipeline that ensures every detection meets production standards.</p>
<p><strong>Key responsibilities</strong>:</p>
<ul>
<li class="">Execute all mandatory testing commands from <code>AGENTS.md</code> (e.g. linting, formatting and both unit and pytests)</li>
<li class="">Validate rule implementation against team standards</li>
<li class="">Provide actionable feedback for fixing issues</li>
<li class="">Ensure compliance with security and coding requirements</li>
</ul>
<p>These checks ensure detections meet our standards, preventing subpar code from being merged. Should a check fail, the LLM will iterate, identifying and implementing necessary changes until compliance is achieved as part of the same recipe run.</p>
<p><strong>Intelligent failure analysis</strong>: The subrecipe doesn&#x27;t just run tests - it analyzes failures and provides specific guidance:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;test_results&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tests_passed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tests_failed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test_details&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;test_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;make lint&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;failed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pylint: missing default value in deep_get() call&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;recommendations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Add default values to all deep_get() calls per AGENTS.md standards&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Reference &#x27;Core Coding Standards&#x27; section for proper error handling&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Output example</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;test_results&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;tests_passed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;tests_failed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;test_details&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;test_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;make fmt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All files formatted correctly&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;test_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;make lint&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;No linting issues found&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;test_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;make test&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Rule tests passed: 2/2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;test_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;make pytest-all&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;passed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All unit tests passed&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;validation_summary&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All mandatory tests passed. Rule ready for PR creation.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;recommendations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-pr_creator-automated-pull-request-pipeline">6. <code>pr_creator</code>: Automated Pull Request Pipeline<a href="#6-pr_creator-automated-pull-request-pipeline" class="hash-link" aria-label="Direct link to 6-pr_creator-automated-pull-request-pipeline" title="Direct link to 6-pr_creator-automated-pull-request-pipeline" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Input</th><th>Output</th></tr></thead><tbody><tr><td><code>rule_files_created</code>, <code>rule_description</code>, <code>branch_name</code>, <code>create_pr</code>, <code>panther_mcp_usage</code></td><td><code>pr_created</code>, <code>pr_url</code>, <code>pr_number</code>, <code>summary</code></td></tr></tbody></table>
<p>This subrecipe handles the final workflow step with full adherence to team standards:</p>
<p><strong>Key responsibilities</strong>:</p>
<ul>
<li class="">Git branch management and commits</li>
<li class="">PR template population with proper formatting</li>
<li class="">Panther MCP usage tracking and reporting</li>
<li class="">Draft PR creation for team review</li>
</ul>
<p><strong>Intelligent PR creation</strong>:</p>
<ul>
<li class=""><em>Conditional execution</em>: Only creates PRs when <code>create_pr=true</code>, otherwise provides summary</li>
<li class=""><em>Template compliance</em>: Automatically populates PR templates from <code>AGENTS.md</code> standards</li>
<li class=""><em>MCP usage reporting</em>: Documents whether Panther MCP was used in the workflow section (which is useful for PR reviewers to know)</li>
</ul>
<p><strong>Git operation standards</strong>:</p>
<ul>
<li class="">Never uses <code>--no-verify</code> flags - fixes issues rather than bypassing them</li>
<li class="">Follows commit message guidelines from team standards</li>
<li class="">Ensures proper branch management and remote synchronization</li>
</ul>
<p><strong>Output example</strong>:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;pr_url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://github.com/&lt;org&gt;/&lt;team&gt;-panther-content/pull/123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;pr_number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;branch_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ai/aws-privilege-escalation&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;commit_hash&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;abc123def&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;files_committed&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;rules/&lt;team&gt;_rules/ai_aws_privilege_escalation.py&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rules/&lt;team&gt;_rules/ai_aws_privilege_escalation.yml&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><em>Quality assurance</em>: This subrecipe includes comprehensive error handling for git failures, PR creation issues, and template population problems, providing clear fallback instructions when automation fails.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling-and-fail-fast-design">Error Handling and Fail-Fast Design<a href="#error-handling-and-fail-fast-design" class="hash-link" aria-label="Direct link to Error Handling and Fail-Fast Design" title="Direct link to Error Handling and Fail-Fast Design" translate="no">‚Äã</a></h2>
<p>This workflow implements sophisticated error handling with intelligent stopping points:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="standardized-response-schema">Standardized Response Schema<a href="#standardized-response-schema" class="hash-link" aria-label="Direct link to Standardized Response Schema" title="Direct link to Standardized Response Schema" translate="no">‚Äã</a></h3>
<p>Every subrecipe uses a consistent JSON response format:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;success&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> boolean</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;error&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Error message if failed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;error_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;categorized_error_type&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* Actual response data */</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;partial_results&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* Optional partial data */</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="failures">Failures<a href="#failures" class="hash-link" aria-label="Direct link to Failures" title="Direct link to Failures" translate="no">‚Äã</a></h3>
<p>This workflow distinguishes between different types of failures. For example, each subrecipe‚Äôs response has an <code>error_code</code> field. When a failure occurs, the LLM categorizes the type of error encountered and surfaces this information to the main recipe so it can make a determination on what to do next.</p>
<p>As an example, <code>rule_creator</code> is configured with these error categories:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">response:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  json_schema:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type: object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          error_type:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enum: [&quot;git_operation_failed&quot;, &quot;pr_creation_failed&quot;, &quot;template_population_failed&quot;, &quot;validation_failed&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            description: &quot;Category of error for debugging purposes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span></code></pre></div></div>
<p>If this subrecipe returns <code>file_creation_failed</code>, we shouldn‚Äôt move on to the <code>testing_validator</code> or <code>pr_creator</code> steps.</p>
<p>This fail-fast approach prevents wasted effort on meaningless subsequent steps.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-usage-examples">Practical Usage Examples<a href="#practical-usage-examples" class="hash-link" aria-label="Direct link to Practical Usage Examples" title="Direct link to Practical Usage Examples" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-usage-fast-detection-creation">Basic Usage: Fast Detection Creation<a href="#basic-usage-fast-detection-creation" class="hash-link" aria-label="Direct link to Basic Usage: Fast Detection Creation" title="Direct link to Basic Usage: Fast Detection Creation" translate="no">‚Äã</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create a detection without creating a PR or similar rule/Panther MCP analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose run --recipe recipe.yaml \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params skip_similar_rules_check=true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params skip_panther_mcp=true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params rule_description=&quot;Create an AWS CloudTrail detection to identify new regions being enabled without any associated errorCodes&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="comprehensive-analysis-mode">Comprehensive Analysis Mode<a href="#comprehensive-analysis-mode" class="hash-link" aria-label="Direct link to Comprehensive Analysis Mode" title="Direct link to Comprehensive Analysis Mode" translate="no">‚Äã</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Full workflow with schema/event sampling and automatic PR creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goose run --recipe recipe.yaml --interactive \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params skip_similar_rules_check=true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params skip_panther_mcp=false \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params create_pr=true \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --params rule_description=&quot;Create a Panther rule that will detect when the user fbar@block.xyz successfully logs in to Okta from a Windows system&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="standards-compliance-and-quality-assurance">Standards Compliance and Quality Assurance<a href="#standards-compliance-and-quality-assurance" class="hash-link" aria-label="Direct link to Standards Compliance and Quality Assurance" title="Direct link to Standards Compliance and Quality Assurance" translate="no">‚Äã</a></h2>
<p>The recipe system ensures compliance with team standards through:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="automated-standards-extraction">Automated Standards Extraction<a href="#automated-standards-extraction" class="hash-link" aria-label="Direct link to Automated Standards Extraction" title="Direct link to Automated Standards Extraction" translate="no">‚Äã</a></h3>
<p>The <code>workflow_setup</code> subrecipe extracts key requirements from <code>AGENTS.md</code>:</p>
<ul>
<li class="">File naming conventions (<code>ai_</code> prefix for AI-created rules)</li>
<li class="">Required Python functions and error handling patterns</li>
<li class="">Testing requirements and validation commands</li>
<li class="">PR creation standards and templates</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="built-in-quality-checks">Built-in Quality Checks<a href="#built-in-quality-checks" class="hash-link" aria-label="Direct link to Built-in Quality Checks" title="Direct link to Built-in Quality Checks" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>Code formatting</strong>: Automatic formatting execution</li>
<li class=""><strong>Linting</strong>: Comprehensive linting validation</li>
<li class=""><strong>Testing</strong>: Mandatory test suite execution</li>
<li class=""><strong>Security</strong>: No PII in test cases (based on LLM&#x27;s determination) and proper error handling (e.g. ensuring default values are returned)</li>
<li class=""><strong>Consistency</strong>: Standardized file structures and naming</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pull-request-automation">Pull Request Automation<a href="#pull-request-automation" class="hash-link" aria-label="Direct link to Pull Request Automation" title="Direct link to Pull Request Automation" translate="no">‚Äã</a></h3>
<p>The <code>pr_creator</code> subrecipe follows team standards:</p>
<ul>
<li class="">Proper branch naming (e.g. <code>ai/&lt;description&gt;</code>)</li>
<li class="">Template-based PR descriptions</li>
<li class="">Draft mode for review</li>
<li class="">Comprehensive change summaries</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="panther-mcp-integration">Panther MCP Integration<a href="#panther-mcp-integration" class="hash-link" aria-label="Direct link to Panther MCP Integration" title="Direct link to Panther MCP Integration" translate="no">‚Äã</a></h3>
<p>The workflow integrates with <a href="https://github.com/panther-labs/mcp-panther" target="_blank" rel="noopener noreferrer" class="">Panther&#x27;s Model Context Protocol</a> (MCP) for:</p>
<ul>
<li class=""><strong>Schema analysis</strong>: Understanding log structure and available fields</li>
<li class=""><strong>Sample data collection</strong>: Gathering realistic test data from data lakes</li>
<li class=""><strong>Field mapping</strong>: Identifying key fields for detection logic</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-and-impact">Benefits and Impact<a href="#benefits-and-impact" class="hash-link" aria-label="Direct link to Benefits and Impact" title="Direct link to Benefits and Impact" translate="no">‚Äã</a></h2>
<p>For Security Teams</p>
<ul>
<li class=""><strong>Faster detection development</strong>: Minutes instead of hours</li>
<li class=""><strong>Consistent quality</strong>: Automated adherence to standards</li>
<li class=""><strong>Reduced errors</strong>: Comprehensive testing before deployment</li>
<li class=""><strong>Knowledge sharing</strong>: Similar rule analysis spreads best practices</li>
</ul>
<p>For AI Development</p>
<ul>
<li class=""><strong>Modular architecture</strong>: Easy to modify individual components</li>
<li class=""><strong>Clear debugging</strong>: Specific failure points and error categories</li>
<li class=""><strong>Predictable behavior</strong>: Consistent outputs across runs</li>
<li class=""><strong>Maintainable code</strong>: Well-defined boundaries and responsibilities</li>
</ul>
<p>For Organizations</p>
<ul>
<li class=""><strong>Accessibility</strong>: Empowers users to create detections without deep knowledge of the underlying detection engine</li>
<li class=""><strong>Scalable security</strong>: Rapid response to new threats</li>
<li class=""><strong>Quality assurance</strong>: Built-in testing and validation</li>
<li class=""><strong>Documentation</strong>: Automatic PR creation with proper context</li>
<li class=""><strong>Compliance</strong>: Adherence to security and development standards</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">‚Äã</a></h2>
<p>Goose&#x27;s recipe and subrecipe system represents a significant advancement in AI-assisted security detection development. By breaking complex workflows into specialized, composable components, teams can achieve:</p>
<ul>
<li class=""><strong>Higher quality detections</strong> through automated testing and validation</li>
<li class=""><strong>Faster development cycles</strong> with intelligent optimization</li>
<li class=""><strong>Better consistency</strong> through standardized processes</li>
<li class=""><strong>Easier maintenance</strong> with modular, well-defined components</li>
</ul>
<p>The detection creation recipe demonstrates how thoughtful architecture and clear separation of concerns can transform a complex, error-prone manual process into a reliable, automated workflow.</p>
<p>Whether you&#x27;re building your first Goose recipe or looking to optimize existing workflows, the patterns and principles outlined here provide a solid foundation for successful automation.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-and-lessons-learned">Best Practices and Lessons Learned<a href="#best-practices-and-lessons-learned" class="hash-link" aria-label="Direct link to Best Practices and Lessons Learned" title="Direct link to Best Practices and Lessons Learned" translate="no">‚Äã</a></h2>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="instruction-formatting--clarity">Instruction Formatting &amp; Clarity<a href="#instruction-formatting--clarity" class="hash-link" aria-label="Direct link to Instruction Formatting &amp; Clarity" title="Direct link to Instruction Formatting &amp; Clarity" translate="no">‚Äã</a></h4>
<ul>
<li class="">Prefer <strong>concise bullet points</strong> over dense paragraphs to keep instructions skimmable.</li>
<li class="">Use <strong>emphasis</strong> (e.g. *<em>bold*</em>, ALL CAPS) to highlight important constraints or behaviors.</li>
<li class="">Write <strong>task-specific</strong> instructions with clear exit criteria ‚Äî avoid asking the agent to do more than it needs to.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="structure--logic-in-prompts">Structure &amp; Logic in Prompts<a href="#structure--logic-in-prompts" class="hash-link" aria-label="Direct link to Structure &amp; Logic in Prompts" title="Direct link to Structure &amp; Logic in Prompts" translate="no">‚Äã</a></h4>
<ul>
<li class="">Use <strong>explicit logic</strong> in templating (e.g., Jinja): define yes/no flags rather than relying on the LLM to infer conditions.</li>
<li class="">Provide <strong>structured output</strong> (e.g. JSON) where needed to support downstream recipes or tools.</li>
<li class=""><strong>Avoid vague labels</strong> ‚Äî use neutral and consistent verbiage (e.g., ‚Äúcorrect/incorrect‚Äù instead of ‚Äúgood/bad‚Äù).</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation--guardrails">Validation &amp; Guardrails<a href="#validation--guardrails" class="hash-link" aria-label="Direct link to Validation &amp; Guardrails" title="Direct link to Validation &amp; Guardrails" translate="no">‚Äã</a></h4>
<ul>
<li class="">Add <strong>code snippets or examples</strong> to illustrate expected behavior.</li>
<li class="">Use <strong>checklists</strong> to help the AI verify whether it followed all required steps.</li>
<li class="">Incorporate <strong>pytests</strong> or other test gates to catch issues early. Avoid bypasses like <code>--no-verify</code> on <code>git</code> commands.<!-- -->
<ul>
<li class=""><strong>Let the system self-correct</strong> where possible.</li>
<li class="">Codify standards so updates are required to pass tests before a PR can be pushed.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="knowledge-sharing--context-management">Knowledge Sharing &amp; Context Management<a href="#knowledge-sharing--context-management" class="hash-link" aria-label="Direct link to Knowledge Sharing &amp; Context Management" title="Direct link to Knowledge Sharing &amp; Context Management" translate="no">‚Äã</a></h4>
<ul>
<li class="">Provide <strong>strong examples</strong> that the agent can learn from, reducing reliance on querying the data lake.</li>
<li class="">Maintain a <strong>central reference</strong> (e.g. <code>AGENTS.md</code>) for all AI agents:<!-- -->
<ul>
<li class="">Users may want to contribute outside of your traditional development workflow</li>
<li class="">Link steps or sections in <code>.goosehints</code>, <code>CLAUDE.md</code>, <code>.cursor/rules/*</code>, etc., back to this file.</li>
<li class="">Consider having an agent help structure <code>AGENTS.md</code> for easier parsing and reuse across agents.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-design">Workflow Design<a href="#workflow-design" class="hash-link" aria-label="Direct link to Workflow Design" title="Direct link to Workflow Design" translate="no">‚Äã</a></h4>
<ul>
<li class="">Use <strong>PR templates and guidelines</strong> to standardize formatting and expectations for AI-generated contributions.</li>
<li class="">Leverage a <strong>shared context across recipes</strong>, but isolate workflows using separate context windows where appropriate.<!-- -->
<ul>
<li class="">Allows output passing and <strong>parallel execution</strong>, while supporting <strong>separation of duties</strong> between steps.</li>
</ul>
</li>
</ul>
</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/goose/blog/2025/07/28/ai-to-ai"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">When AI Meets AI: Goose Desktop and CLI Collaborate</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/goose/blog/2025/07/21/orchestrating-subagents"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Orchestrating 6 Subagents to Build a Collaborative API Playground for Kids</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-recipes" class="table-of-contents__link toc-highlight">What Are Recipes?</a><ul><li><a href="#what-about-goosehints" class="table-of-contents__link toc-highlight">What about .goosehints?</a></li></ul></li><li><a href="#the-architecture" class="table-of-contents__link toc-highlight">The Architecture</a><ul><li><a href="#design-principles" class="table-of-contents__link toc-highlight">Design Principles</a></li><li><a href="#why-subrecipes-matter" class="table-of-contents__link toc-highlight">Why Subrecipes Matter</a></li></ul></li><li><a href="#data-flow-and-state-management" class="table-of-contents__link toc-highlight">Data Flow and State Management</a></li><li><a href="#smart-optimizations-conditional-execution" class="table-of-contents__link toc-highlight">Smart Optimizations: Conditional Execution</a><ul><li><a href="#parameter-based-conditions" class="table-of-contents__link toc-highlight">Parameter-Based Conditions</a></li><li><a href="#runtime-conditions" class="table-of-contents__link toc-highlight">Runtime Conditions</a></li></ul></li><li><a href="#deep-dive-key-subrecipes" class="table-of-contents__link toc-highlight">Deep Dive: Key Subrecipes</a><ul><li><a href="#1-workflow_setup-foundation-first" class="table-of-contents__link toc-highlight">1. <code>workflow_setup</code>: Foundation First</a></li><li><a href="#2-similar_rule_analyzer-learning-from-existing-patterns" class="table-of-contents__link toc-highlight">2. <code>similar_rule_analyzer</code>: Learning from Existing Patterns</a></li><li><a href="#3-schema_and_sample_events_analyzer-data-driven-detection-logic" class="table-of-contents__link toc-highlight">3. <code>schema_and_sample_events_analyzer</code>: Data-Driven Detection Logic</a></li><li><a href="#4-rule_creator-the-implementation-engine" class="table-of-contents__link toc-highlight">4. <code>rule_creator</code>: The Implementation Engine</a></li><li><a href="#5-testing_validator-quality-assurance" class="table-of-contents__link toc-highlight">5. <code>testing_validator</code>: Quality Assurance</a></li><li><a href="#6-pr_creator-automated-pull-request-pipeline" class="table-of-contents__link toc-highlight">6. <code>pr_creator</code>: Automated Pull Request Pipeline</a></li></ul></li><li><a href="#error-handling-and-fail-fast-design" class="table-of-contents__link toc-highlight">Error Handling and Fail-Fast Design</a><ul><li><a href="#standardized-response-schema" class="table-of-contents__link toc-highlight">Standardized Response Schema</a></li><li><a href="#failures" class="table-of-contents__link toc-highlight">Failures</a></li></ul></li><li><a href="#practical-usage-examples" class="table-of-contents__link toc-highlight">Practical Usage Examples</a><ul><li><a href="#basic-usage-fast-detection-creation" class="table-of-contents__link toc-highlight">Basic Usage: Fast Detection Creation</a></li><li><a href="#comprehensive-analysis-mode" class="table-of-contents__link toc-highlight">Comprehensive Analysis Mode</a></li></ul></li><li><a href="#standards-compliance-and-quality-assurance" class="table-of-contents__link toc-highlight">Standards Compliance and Quality Assurance</a><ul><li><a href="#automated-standards-extraction" class="table-of-contents__link toc-highlight">Automated Standards Extraction</a></li><li><a href="#built-in-quality-checks" class="table-of-contents__link toc-highlight">Built-in Quality Checks</a></li><li><a href="#pull-request-automation" class="table-of-contents__link toc-highlight">Pull Request Automation</a></li><li><a href="#panther-mcp-integration" class="table-of-contents__link toc-highlight">Panther MCP Integration</a></li></ul></li><li><a href="#benefits-and-impact" class="table-of-contents__link toc-highlight">Benefits and Impact</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#best-practices-and-lessons-learned" class="table-of-contents__link toc-highlight">Best Practices and Lessons Learned</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Quick Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/docs/getting-started/installation">Install goose</a></li><li class="footer__item"><a class="footer__link-item" href="/goose/extensions">Extensions</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/community">Spotlight</a></li><li class="footer__item"><a href="https://discord.gg/goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/goose_oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter / X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/opensource.block.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">BlueSky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://njump.me/opensource@block.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">Nostr<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/block/goose" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2026 Block, Inc.</div></div></div></footer></div>
<script src="/goose/inkeepChatButton.js" type="module"></script>
<div id="inkeepSearchBar"></div>
<script>(()=>{const e=document.getElementById("inkeepSearchBar");new MutationObserver(t=>{const n=document.getElementById("inkeep");n&&n.appendChild(e)}).observe(document.documentElement,{attributes:!0})})()</script>
<script src="/goose/inkeepSearchBar.js" type="module"></script></body>
</html>