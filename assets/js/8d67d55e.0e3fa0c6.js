/*! For license information please see 8d67d55e.0e3fa0c6.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkgoose=globalThis.webpackChunkgoose||[]).push([[2177],{11470:(e,n,t)=>{t.d(n,{A:()=>w});var s=t(96540),o=t(34164),i=t(17559),r=t(23104),a=t(56347),l=t(205),c=t(57485),d=t(31682),h=t(70679);function u(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function x({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(o),(0,s.useCallback)(e=>{if(!o)return;const n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})},[o,t])]}function p(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,i=m(e),[r,a]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!x({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i})),[c,d]=g({queryString:t,groupId:o}),[u,p]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,o]=(0,h.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&o.set(e)},[n,o])]}({groupId:o}),j=(()=>{const e=c??u;return x({value:e,tabValues:i})?e:null})();(0,l.A)(()=>{j&&a(j)},[j]);return{selectedValue:r,selectValue:(0,s.useCallback)(e=>{if(!x({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),d(e),p(e)},[d,p,i]),tabValues:i}}var j=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=t(74848);function b({className:e,block:n,selectedValue:t,selectValue:s,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),c=e=>{const n=e.currentTarget,o=a.indexOf(n),r=i[o].value;r!==t&&(l(n),s(r))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:s})=>(0,v.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...s,className:(0,o.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function y({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===t);return e?(0,s.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function T(e){const n=p(e);return(0,v.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",f.tabList),children:[(0,v.jsx)(b,{...n,...e}),(0,v.jsx)(y,{...n,...e})]})}function w(e){const n=(0,j.A)();return(0,v.jsx)(T,{...e,children:u(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var s=t(34164);const o={tabItem:"tabItem_Ymn6"};var i=t(74848);function r({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(o.tabItem,t),hidden:n,children:e})}},25134:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>h,default:()=>g,frontMatter:()=>d,metadata:()=>s,toc:()=>m});const s=JSON.parse('{"id":"guides/sessions/smart-context-management","title":"Smart Context Management","description":"When working with Large Language Models (LLMs), there are limits to how much conversation history they can process at once. goose provides smart context management features to help handle context and conversation limits so you can maintain productive sessions. Here are some key concepts:","source":"@site/docs/guides/sessions/smart-context-management.md","sourceDirName":"guides/sessions","slug":"/guides/sessions/smart-context-management","permalink":"/goose/docs/guides/sessions/smart-context-management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Smart Context Management","sidebar_position":3,"sidebar_label":"Smart Context Management"},"sidebar":"tutorialSidebar","previous":{"title":"In-Session Actions","permalink":"/goose/docs/guides/sessions/in-session-actions"},"next":{"title":"Context Engineering","permalink":"/goose/docs/guides/context-engineering/"}}');var o=t(74848),i=t(28453),r=t(11470),a=t(19365);const l=(0,t(75395).A)("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);var c=t(71112);const d={title:"Smart Context Management",sidebar_position:3,sidebar_label:"Smart Context Management"},h=void 0,u={},m=[{value:"How goose Manages Context",id:"how-goose-manages-context",level:2},{value:"Automatic Compaction",id:"automatic-compaction",level:2},{value:"Manual Compaction",id:"manual-compaction",level:3},{value:"Context Limit Strategies",id:"context-limit-strategies",level:2},{value:"Maximum Turns",id:"maximum-turns",level:2},{value:"Token Usage",id:"token-usage",level:2},{value:"Model Context Limit Overrides",id:"model-context-limit-overrides",level:2},{value:"Cost Tracking",id:"cost-tracking",level:2}];function x(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["When working with ",(0,o.jsx)(n.a,{href:"/docs/getting-started/providers",children:"Large Language Models (LLMs)"}),", there are limits to how much conversation history they can process at once. goose provides smart context management features to help handle context and conversation limits so you can maintain productive sessions. Here are some key concepts:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Context Length"}),": The amount of conversation history the LLM can consider, also referred to as the context window"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Context Limit"}),": The maximum number of tokens the model can process"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Context Management"}),": How goose handles conversations approaching these limits"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Turn"}),": One complete prompt-response interaction between goose and the LLM"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"how-goose-manages-context",children:"How goose Manages Context"}),"\n",(0,o.jsx)(n.p,{children:"goose uses a two-tiered approach to context management:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Auto-Compaction"}),": Proactively summarizes conversation when approaching token limits"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Context Strategies"}),": Backup strategy used if the context limit is still exceeded after auto-compaction"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This layered approach lets goose handle token and context limits gracefully."}),"\n",(0,o.jsx)(n.h2,{id:"automatic-compaction",children:"Automatic Compaction"}),"\n",(0,o.jsx)(n.p,{children:"goose automatically compacts (summarizes) older parts of your conversation when approaching token limits, allowing you to maintain long-running sessions without manual intervention.\nAuto-compaction is triggered by default when you reach 80% of the token limit in goose Desktop and the goose CLI."}),"\n",(0,o.jsxs)(n.p,{children:["Control the auto-compaction behavior with the ",(0,o.jsx)(n.code,{children:"GOOSE_AUTO_COMPACT_THRESHOLD"})," ",(0,o.jsx)(n.a,{href:"/goose/docs/guides/environment-variables#session-management",children:"environment variable"}),".\nDisable this feature by setting the value to ",(0,o.jsx)(n.code,{children:"0.0"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# Automatically compact sessions when 60% of available tokens are used\nexport GOOSE_AUTO_COMPACT_THRESHOLD=0.6\n"})}),"\n",(0,o.jsx)(n.p,{children:"When you reach the auto-compaction threshold:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"goose will automatically start compacting the conversation to make room."}),"\n",(0,o.jsx)(n.li,{children:"Once complete, you'll see a confirmation message that the conversation was compacted and summarized."}),"\n",(0,o.jsx)(n.li,{children:"Continue the session. Your previous conversation remains visible, but only the compacted conversion is included in the active context for goose."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"manual-compaction",children:"Manual Compaction"}),"\n",(0,o.jsx)(n.p,{children:"You can also trigger compaction manually before reaching context or token limits:"}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsxs)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:[(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Point to the token usage indicator dot next to the model name at the bottom of the app"}),"\n",(0,o.jsxs)(n.li,{children:["Click ",(0,o.jsx)(l,{className:"inline",size:16})," ",(0,o.jsx)(n.code,{children:"Compact now"})," in the context window that appears"]}),"\n",(0,o.jsx)(n.li,{children:"Once complete, you'll see a confirmation message that the conversation was compacted and summarized."}),"\n",(0,o.jsx)(n.li,{children:"Continue the session. Your previous conversation remains visible, but only the compacted conversion is included in the active context for goose."}),"\n"]}),(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsx)(n.mdxAdmonitionTitle,{}),(0,o.jsxs)(n.p,{children:["You must send at least one message in the chat before the ",(0,o.jsx)(n.code,{children:"Compact now"})," button is enabled."]})]})]}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",default:!0,children:[(0,o.jsxs)(n.p,{children:["To proactively trigger summarization before reaching context limits, use the ",(0,o.jsx)(n.code,{children:"/summarize"})," command:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"( O)> /summarize\n\u25c7  Are you sure you want to summarize this conversation? This will condense the message history.\n\u2502  Yes \n\u2502\nSummarizing conversation...\nConversation has been summarized.\nKey information has been preserved while reducing context length.\n"})})]})]}),"\n",(0,o.jsx)(n.h2,{id:"context-limit-strategies",children:"Context Limit Strategies"}),"\n",(0,o.jsx)(n.p,{children:"When auto-compaction is disabled, or if a conversation still exceeds the context limit, goose offers different ways to handle it:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Feature"}),(0,o.jsx)(n.th,{children:"Description"}),(0,o.jsx)(n.th,{children:"Best For"}),(0,o.jsx)(n.th,{children:"Availability"}),(0,o.jsx)(n.th,{children:"Impact"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Summarization"})}),(0,o.jsx)(n.td,{children:"Condenses conversation while preserving key points"}),(0,o.jsx)(n.td,{children:"Long, complex conversations"}),(0,o.jsx)(n.td,{children:"Desktop and CLI"}),(0,o.jsx)(n.td,{children:"Maintains most context"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Truncation"})}),(0,o.jsx)(n.td,{children:"Removes oldest messages to make room"}),(0,o.jsx)(n.td,{children:"Simple, linear conversations"}),(0,o.jsx)(n.td,{children:"CLI only"}),(0,o.jsx)(n.td,{children:"Loses old context"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Clear"})}),(0,o.jsx)(n.td,{children:"Starts fresh while keeping session active"}),(0,o.jsx)(n.td,{children:"New direction in conversation"}),(0,o.jsx)(n.td,{children:"CLI only"}),(0,o.jsx)(n.td,{children:"Loses all context"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Prompt"})}),(0,o.jsx)(n.td,{children:"Asks user to choose from the above options"}),(0,o.jsx)(n.td,{children:"Control over each decision in interactive sessions"}),(0,o.jsx)(n.td,{children:"CLI only"}),(0,o.jsx)(n.td,{children:"Depends on choice made"})]})]})]}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsx)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:(0,o.jsx)(n.p,{children:"goose Desktop exclusively uses summarization by compacting the conversation to manage context, preserving key information while reducing size."})}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",children:[(0,o.jsxs)(n.p,{children:["The CLI supports all context limit strategies: ",(0,o.jsx)(n.code,{children:"summarize"}),", ",(0,o.jsx)(n.code,{children:"truncate"}),", ",(0,o.jsx)(n.code,{children:"clear"}),", and ",(0,o.jsx)(n.code,{children:"prompt"}),"."]}),(0,o.jsx)(n.p,{children:"The default behavior depends on the mode you're running in:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Interactive mode"}),": Prompts user to choose (equivalent to ",(0,o.jsx)(n.code,{children:"prompt"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Headless mode"})," (",(0,o.jsx)(n.code,{children:"goose run"}),"): Automatically summarizes (equivalent to ",(0,o.jsx)(n.code,{children:"summarize"}),")"]}),"\n"]}),(0,o.jsxs)(n.p,{children:["You can configure how goose handles context limits by setting the ",(0,o.jsx)(n.code,{children:"GOOSE_CONTEXT_STRATEGY"})," environment variable:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Set automatic strategy (choose one)\nexport GOOSE_CONTEXT_STRATEGY=summarize  # Automatically summarize (recommended)\nexport GOOSE_CONTEXT_STRATEGY=truncate   # Automatically remove oldest messages\nexport GOOSE_CONTEXT_STRATEGY=clear      # Automatically clear session\n\n# Set to prompt the user\nexport GOOSE_CONTEXT_STRATEGY=prompt\n"})}),(0,o.jsx)(n.p,{children:"When you hit the context limit, the behavior depends on your configuration:"}),(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["With default settings (no ",(0,o.jsx)(n.code,{children:"GOOSE_CONTEXT_STRATEGY"})," set)"]}),", you'll see this prompt to choose a management option:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"\u25c7  The model's context length is maxed out. You will need to reduce the # msgs. Do you want to?\n\u2502  \u25cb Clear Session   \n\u2502  \u25cb Truncate Message\n// highlight-start\n\u2502  \u25cf Summarize Session\n// highlight-end\n\nfinal_summary: [A summary of your conversation will appear here]\n\nContext maxed out\n--------------------------------------------------\ngoose summarized messages for you.\n"})}),(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["With ",(0,o.jsx)(n.code,{children:"GOOSE_CONTEXT_STRATEGY"})," configured"]}),", goose will automatically apply your chosen strategy:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"# Example with GOOSE_CONTEXT_STRATEGY=summarize\nContext maxed out - automatically summarized messages.\n--------------------------------------------------\ngoose automatically summarized messages for you.\n\n# Example with GOOSE_CONTEXT_STRATEGY=truncate\nContext maxed out - automatically truncated messages.\n--------------------------------------------------\ngoose tried its best to truncate messages for you.\n\n# Example with GOOSE_CONTEXT_STRATEGY=clear\nContext maxed out - automatically cleared session.\n--------------------------------------------------\n"})})]})]}),"\n",(0,o.jsx)(n.h2,{id:"maximum-turns",children:"Maximum Turns"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Max Turns"}),' limit is the maximum number of consecutive turns that goose can take without user input (default: 1000). When the limit is reached, goose stops and prompts: "I\'ve reached the maximum number of actions I can do without user input. Would you like me to continue?" If the user answers in the affirmative, goose continues until the limit is reached and then prompts again.']}),"\n",(0,o.jsx)(n.p,{children:"This feature gives you control over agent autonomy and prevents infinite loops and runaway behavior, which could have significant cost consequences or damaging impact in production environments. Use it for:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Preventing infinite loops and excessive API calls or resource consumption in automated tasks"}),"\n",(0,o.jsx)(n.li,{children:"Enabling human supervision or interaction during autonomous operations"}),"\n",(0,o.jsx)(n.li,{children:"Controlling loops while testing and debugging agent behavior"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This setting is stored as the ",(0,o.jsx)(n.code,{children:"GOOSE_MAX_TURNS"})," environment variable in your ",(0,o.jsx)(n.a,{href:"/docs/guides/config-files",children:"config.yaml file"}),". You can configure it using the Desktop app or CLI."]}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsx)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(c.A,{className:"inline",size:16})," button in the top-left to open the sidebar"]}),"\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(n.code,{children:"Settings"})," button on the sidebar"]}),"\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(n.code,{children:"Chat"})," tab"]}),"\n",(0,o.jsxs)(n.li,{children:["Scroll to ",(0,o.jsx)(n.code,{children:"Conversation Limits"})," and enter a value for ",(0,o.jsx)(n.code,{children:"Max Turns"})]}),"\n"]})}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",children:[(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Run the ",(0,o.jsx)(n.code,{children:"configuration"})," command:"]}),"\n"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"goose configure\n"})}),(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["Select ",(0,o.jsx)(n.code,{children:"goose settings"}),":"]}),"\n"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"\u250c   goose-configure\n\u2502\n\u25c6  What would you like to configure?\n\u2502  \u25cb Configure Providers\n\u2502  \u25cb Add Extension\n\u2502  \u25cb Toggle Extensions\n\u2502  \u25cb Remove Extension\n// highlight-start\n\u2502  \u25cf goose settings (Set the goose mode, Tool Output, Tool Permissions, Experiment, goose recipe github repo and more)\n// highlight-end\n\u2514 \n"})}),(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:["Select ",(0,o.jsx)(n.code,{children:"Max Turns"}),":"]}),"\n"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"\u250c   goose-configure\n\u2502\n\u25c7  What would you like to configure?\n\u2502  goose settings\n\u2502\n\u25c6  What setting would you like to configure?\n\u2502  \u25cb goose mode \n\u2502  \u25cb Router Tool Selection Strategy \n\u2502  \u25cb Tool Permission \n\u2502  \u25cb Tool Output \n// highlight-start\n\u2502  \u25cf Max Turns (Set maximum number of turns without user input)\n// highlight-end\n\u2502  \u25cb Toggle Experiment \n\u2502  \u25cb goose recipe github repo \n\u2502  \u25cb Scheduler Type \n\u2514 \n"})}),(0,o.jsxs)(n.ol,{start:"4",children:["\n",(0,o.jsx)(n.li,{children:"Enter the maximum number of turns:"}),"\n"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"\u250c   goose-configure \n\u2502\n\u25c7  What would you like to configure?\n\u2502  goose settings \n\u2502\n\u25c7  What setting would you like to configure?\n\u2502  Max Turns \n\u2502\n  // highlight-start\n\u25c6  Set maximum number of agent turns without user input:\n\u2502  10\n  // highlight-end\n\u2502\n\u2514  Set maximum turns to 10 - goose will ask for input after 10 consecutive actions\n"})}),(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["In addition to the persistent ",(0,o.jsx)(n.code,{children:"Max Turns"})," setting, you can provide a runtime override for a specific session or task via the ",(0,o.jsx)(n.code,{children:"goose session --max-turns"})," and ",(0,o.jsx)(n.code,{children:"goose run --max-turns"})," ",(0,o.jsx)(n.a,{href:"/docs/guides/goose-cli-commands",children:"CLI commands"}),"."]})})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Choosing the Right Value"})}),"\n",(0,o.jsx)(n.p,{children:"The appropriate max turns value depends on your use case and comfort level with automation:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"5-10 turns"}),': Good for exploratory tasks, debugging, or when you want frequent check-ins. For example, "analyze this codebase and suggest improvements" where you want to review each step']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"25-50 turns"}),': Effective for well-defined tasks with moderate complexity, such as "refactor this module to use the new API" or "set up a basic CI/CD pipeline"']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"100+ turns"}),': More suitable for complex, multi-step automation where you trust goose to work independently, like "migrate this entire project from React 16 to React 18" or "implement comprehensive test coverage for this service"']}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:'Remember that even simple-seeming tasks often require multiple turns. For example, asking goose to "fix the failing tests" might involve analyzing test output (1 turn), identifying the root cause (1 turn), making code changes (1 turn), and verifying the fix (1 turn).'}),"\n",(0,o.jsx)(n.h2,{id:"token-usage",children:"Token Usage"}),"\n",(0,o.jsx)(n.p,{children:"After sending your first message, goose Desktop and goose CLI display token usage."}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsxs)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:[(0,o.jsx)(n.p,{children:"The Desktop displays a colored circle next to the model name at the bottom of the session window. The color provides a visual indicator of your token usage for the session."}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Green"}),": Normal usage - Plenty of context space available"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Orange"}),": Warning state - Approaching limit (80% of capacity)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Red"}),": Error state - Context limit reached"]}),"\n"]}),(0,o.jsx)(n.p,{children:"Hover over this circle to display:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The number of tokens used"}),"\n",(0,o.jsx)(n.li,{children:"The percentage of available tokens used"}),"\n",(0,o.jsx)(n.li,{children:"The total available tokens"}),"\n",(0,o.jsx)(n.li,{children:"A progress bar showing your current token usage"}),"\n"]})]}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",children:[(0,o.jsx)(n.p,{children:"The CLI displays a context label above each command prompt, showing:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["A visual indicator using dots (\u25cf\u25cb) and colors to represent your token usage:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Green"}),": Below 50% usage"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Yellow"}),": Between 50-85% usage"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Red"}),": Above 85% usage"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Usage percentage"}),"\n",(0,o.jsx)(n.li,{children:"Current token count and context limit"}),"\n"]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"model-context-limit-overrides",children:"Model Context Limit Overrides"}),"\n",(0,o.jsx)(n.p,{children:"Context limits are automatically detected based on your model name, but goose provides settings to override the default limits:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Model"}),(0,o.jsx)(n.th,{children:"Description"}),(0,o.jsx)(n.th,{children:"Best For"}),(0,o.jsx)(n.th,{children:"Setting"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Main"})}),(0,o.jsx)(n.td,{children:"Set context limit for the main model (also serves as fallback for other models)"}),(0,o.jsx)(n.td,{children:"LiteLLM proxies, custom models with non-standard names"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GOOSE_CONTEXT_LIMIT"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Lead"})}),(0,o.jsxs)(n.td,{children:["Set larger context for planning in ",(0,o.jsx)(n.a,{href:"/docs/tutorials/lead-worker",children:"lead/worker mode"})]}),(0,o.jsx)(n.td,{children:"Complex planning tasks requiring more context"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GOOSE_LEAD_CONTEXT_LIMIT"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Worker"})}),(0,o.jsx)(n.td,{children:"Set smaller context for execution in lead/worker mode"}),(0,o.jsx)(n.td,{children:"Cost optimization during execution phase"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GOOSE_WORKER_CONTEXT_LIMIT"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Planner"})}),(0,o.jsxs)(n.td,{children:["Set context for ",(0,o.jsx)(n.a,{href:"/docs/guides/creating-plans",children:"planner models"})]}),(0,o.jsx)(n.td,{children:"Large planning tasks requiring extensive context"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"GOOSE_PLANNER_CONTEXT_LIMIT"})})]})]})]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"This setting only affects the displayed token usage and progress indicators. Actual context management is handled by your LLM, so you may experience more or less usage than the limit you set, regardless of what the display shows."})}),"\n",(0,o.jsx)(n.p,{children:"This feature is particularly useful with:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"LiteLLM Proxy Models"}),": When using LiteLLM with custom model names that don't match goose's patterns"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Enterprise Deployments"}),": Custom model deployments with non-standard naming"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Fine-tuned Models"}),": Custom models with different context limits than their base versions"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Development/Testing"}),": Temporarily adjusting context limits for testing purposes"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"goose resolves context limits with the following precedence (highest to lowest):"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Explicit context_limit in model configuration (if set programmatically)"}),"\n",(0,o.jsxs)(n.li,{children:["Specific environment variable (e.g., ",(0,o.jsx)(n.code,{children:"GOOSE_LEAD_CONTEXT_LIMIT"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:["Global environment variable (",(0,o.jsx)(n.code,{children:"GOOSE_CONTEXT_LIMIT"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Model-specific default based on name pattern matching"}),"\n",(0,o.jsx)(n.li,{children:"Global default (128,000 tokens)"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Configuration"})}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsx)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:(0,o.jsx)(n.p,{children:"Model context limit overrides are not yet available in the goose Desktop app."})}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",children:[(0,o.jsxs)(n.p,{children:["Context limit overrides only work as ",(0,o.jsx)(n.a,{href:"/docs/guides/environment-variables#model-context-limit-overrides",children:"environment variables"}),", not in the config file."]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export GOOSE_CONTEXT_LIMIT=1000\ngoose session\n"})})]})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Scenarios"})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"LiteLLM proxy with custom model name"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# LiteLLM proxy with custom model name\nexport GOOSE_PROVIDER="openai"\nexport GOOSE_MODEL="my-custom-gpt4-proxy"\nexport GOOSE_CONTEXT_LIMIT=200000  # Override the 32k default\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"Lead/worker setup with different context limits"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Different context limits for planning vs execution\nexport GOOSE_LEAD_MODEL="claude-opus-custom"\nexport GOOSE_LEAD_CONTEXT_LIMIT=500000    # Large context for planning\nexport GOOSE_WORKER_CONTEXT_LIMIT=128000  # Smaller context for execution\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Planner with large context"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Large context for complex planning\nexport GOOSE_PLANNER_MODEL="gpt-4-custom"\nexport GOOSE_PLANNER_CONTEXT_LIMIT=1000000\n'})}),"\n",(0,o.jsx)(n.h2,{id:"cost-tracking",children:"Cost Tracking"}),"\n",(0,o.jsx)(n.p,{children:"Display real-time estimated costs of your session."}),"\n",(0,o.jsxs)(r.A,{groupId:"interface",children:[(0,o.jsxs)(a.A,{value:"ui",label:"goose Desktop",default:!0,children:[(0,o.jsx)(n.p,{children:"To manage live cost tracking:"}),(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(c.A,{className:"inline",size:16})," button in the top-left to open the sidebar"]}),"\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(n.code,{children:"Settings"})," button on the sidebar"]}),"\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(n.code,{children:"App"})," tab"]}),"\n",(0,o.jsxs)(n.li,{children:["Toggle ",(0,o.jsx)(n.code,{children:"Cost Tracking"})," on/off"]}),"\n"]}),(0,o.jsx)(n.p,{children:"The session cost is shown at the bottom of the goose window and updates dynamically as tokens are consumed. Hover over the cost to see a detailed breakdown of token usage. If multiple models are used in the session, this includes a cost breakdown by model. Ollama and local deployments always show a cost of $0.00."}),(0,o.jsxs)(n.p,{children:["Pricing data is regularly fetched from the OpenRouter API and cached locally. The ",(0,o.jsx)(n.code,{children:"Advanced settings"})," tab shows when the data was last updated and allows you to refresh."]}),(0,o.jsx)(n.p,{children:"These costs are estimates only, and not connected to your actual provider bill. The cost shown is an approximation based on token counts and public pricing data."})]}),(0,o.jsxs)(a.A,{value:"cli",label:"goose CLI",children:[(0,o.jsxs)(n.p,{children:["Show estimated cost in the goose CLI by setting the ",(0,o.jsx)(n.code,{children:"GOOSE_CLI_SHOW_COST"})," ",(0,o.jsx)(n.a,{href:"/goose/docs/guides/environment-variables#session-management",children:"environment variable"})," or including it in the ",(0,o.jsx)(n.a,{href:"/goose/docs/guides/config-files",children:"configuration file"}),"."]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# Set environment variable\nexport GOOSE_CLI_SHOW_COST=true\n\n# config.yaml\nGOOSE_CLI_SHOW_COST: true\n"})})]})]})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(x,{...e})}):x(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},71112:(e,n,t)=>{t.d(n,{A:()=>s});const s=(0,t(75395).A)("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]])},75395:(e,n,t)=>{t.d(n,{A:()=>a});var s=t(96540);const o=(...e)=>e.filter((e,n,t)=>Boolean(e)&&""!==e.trim()&&t.indexOf(e)===n).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const r=(0,s.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:a="",children:l,iconNode:c,...d},h)=>(0,s.createElement)("svg",{ref:h,...i,width:n,height:n,stroke:e,strokeWidth:r?24*Number(t)/Number(n):t,className:o("lucide",a),...d},[...c.map(([e,n])=>(0,s.createElement)(e,n)),...Array.isArray(l)?l:[l]])),a=(e,n)=>{const t=(0,s.forwardRef)(({className:t,...i},a)=>{return(0,s.createElement)(r,{ref:a,iconNode:n,className:o(`lucide-${l=e,l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,t),...i});var l});return t.displayName=`${e}`,t}}}]);