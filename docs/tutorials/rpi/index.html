<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/rpi" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Research → Plan → Implement Pattern | goose</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://block.github.io/goose/img/home-banner.png"><meta data-rh="true" name="twitter:image" content="https://block.github.io/goose/img/home-banner.png"><meta data-rh="true" property="og:url" content="https://block.github.io/goose/docs/tutorials/rpi"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Research → Plan → Implement Pattern | goose"><meta data-rh="true" name="description" content="How to use RPI, a context engineering technique, on complex software projects"><meta data-rh="true" property="og:description" content="How to use RPI, a context engineering technique, on complex software projects"><link data-rh="true" rel="icon" href="/goose/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://block.github.io/goose/docs/tutorials/rpi"><link data-rh="true" rel="alternate" href="https://block.github.io/goose/docs/tutorials/rpi" hreflang="en"><link data-rh="true" rel="alternate" href="https://block.github.io/goose/docs/tutorials/rpi" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://block.github.io/goose/docs/category/tutorials"},{"@type":"ListItem","position":2,"name":"Research → Plan → Implement Pattern","item":"https://block.github.io/goose/docs/tutorials/rpi"}]}</script><link rel="alternate" type="application/rss+xml" href="/goose/blog/rss.xml" title="goose RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/goose/blog/atom.xml" title="goose Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZS5D6SB4ZJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZS5D6SB4ZJ",{anonymize_ip:!0})</script>









<link rel="alternate" type="text/plain" title="LLM context" href="/goose/llms.txt"><link rel="stylesheet" href="/goose/assets/css/styles.55a7d422.css">
<script src="/goose/assets/js/runtime~main.ce4b0899.js" defer="defer"></script>
<script src="/goose/assets/js/main.83a81719.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/goose/img/logo_light.png"><link rel="preload" as="image" href="/goose/img/logo_dark.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/goose/"><div class="navbar__logo"><img src="/goose/img/logo_light.png" alt="Block Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/goose/img/logo_dark.png" alt="Block Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/goose/docs/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/goose/docs/category/guides">Docs</a><a class="navbar__item navbar__link" href="/goose/docs/category/tutorials">Tutorials</a><a class="navbar__item navbar__link" href="/goose/docs/category/mcp-servers">MCPs</a><a class="navbar__item navbar__link" href="/goose/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/goose/extensions">Extensions</a></li><li><a class="dropdown__link" href="/goose/recipe-generator">Recipe Generator</a></li><li><a class="dropdown__link" href="/goose/prompt-library">Prompt Library</a></li><li><a class="dropdown__link" href="/goose/recipes">Recipe Cookbook</a></li><li><a class="dropdown__link" href="/goose/deeplink-generator">Deeplink Generator</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://discord.gg/goose-oss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/block/goose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="inkeep"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/goose/docs/quickstart"><span title="Quickstart" class="linkLabel_WmDU">Quickstart</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/category/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/category/guides"><span title="Guides" class="categoryLinkLabel_W154">Guides</span></a><button aria-label="Expand sidebar category &#x27;Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/goose/docs/category/tutorials"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a><button aria-label="Collapse sidebar category &#x27;Tutorials&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/advanced-cognee-usage"><span title="Advanced Cognee Usage with goose" class="linkLabel_WmDU">Advanced Cognee Usage with goose</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/benchmarking"><span title="Benchmark with goose" class="linkLabel_WmDU">Benchmark with goose</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/building-mcp-apps"><span title="Building MCP Apps" class="linkLabel_WmDU">Building MCP Apps</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/cicd"><span title="CI/CD Environments" class="linkLabel_WmDU">CI/CD Environments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/custom-extensions"><span title="Building Custom Extensions" class="linkLabel_WmDU">Building Custom Extensions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/goose-in-docker"><span title="goose in Docker" class="linkLabel_WmDU">goose in Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/headless-goose"><span title="Using goose in Headless Mode for Automation" class="linkLabel_WmDU">Using goose in Headless Mode for Automation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/isolated-development-environments"><span title="Isolated Development Environments" class="linkLabel_WmDU">Isolated Development Environments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/langfuse"><span title="Observability with Langfuse" class="linkLabel_WmDU">Observability with Langfuse</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/lead-worker"><span title="Lead/Worker Multi-Model Setup" class="linkLabel_WmDU">Lead/Worker Multi-Model Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/plan-feature-devcontainer-setup"><span title="Planning Complex Tasks" class="linkLabel_WmDU">Planning Complex Tasks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/recipes-tutorial"><span title="Recipes" class="linkLabel_WmDU">Recipes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/goose/docs/tutorials/rpi"><span title="Research → Plan → Implement Pattern" class="linkLabel_WmDU">Research → Plan → Implement Pattern</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goose/docs/tutorials/subrecipes-in-parallel"><span title="Subrecipes In Parallel" class="linkLabel_WmDU">Subrecipes In Parallel</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/category/mcp-servers"><span title="MCP Servers" class="categoryLinkLabel_W154">MCP Servers</span></a><button aria-label="Expand sidebar category &#x27;MCP Servers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/category/architecture-overview"><span title="Architecture Overview" class="categoryLinkLabel_W154">Architecture Overview</span></a><button aria-label="Expand sidebar category &#x27;Architecture Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/experimental/"><span title="Experimental" class="categoryLinkLabel_W154">Experimental</span></a><button aria-label="Expand sidebar category &#x27;Experimental&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/goose/docs/troubleshooting/"><span title="Troubleshooting" class="categoryLinkLabel_W154">Troubleshooting</span></a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col col--9"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/goose/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/goose/docs/category/tutorials"><span>Tutorials</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Research → Plan → Implement Pattern</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header class="flex justify-between items-start mb-4 flex-col md:flex-row gap-2 md:gap-0"><h1 class="m-0 flex-1">Research → Plan → Implement Pattern</h1><div class="relative inline-flex"><div class="flex items-center bg-black dark:bg-white rounded-md"><div class="[&amp;&gt;button]:rounded-r-none"><button class="flex items-center gap-1.5 px-3 py-1.5 bg-black dark:bg-white text-white dark:text-black rounded-md text-sm font-medium transition-all duration-200 ease-in-out hover:opacity-90 hover:-translate-y-px focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white focus:ring-offset-2 active:translate-y-px disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:opacity-60 disabled:hover:translate-y-0" aria-label="Copy page to clipboard" type="button" disabled=""><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy flex-shrink-0" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg>Copy page</button></div><div class="w-px h-4 bg-gray-700 dark:bg-gray-300"></div><button class="px-2 py-1.5 bg-black dark:bg-white text-white dark:text-black rounded-l-none rounded-r-md text-sm font-medium transition-all duration-200 ease-in-out hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white focus:ring-offset-2 flex items-center justify-center" aria-label="More page actions" aria-expanded="false" aria-haspopup="true"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down transition-transform duration-200"><path d="m6 9 6 6 6-6"></path></svg></button></div></div></header><p>Most people use AI agents by jumping straight to execution: &quot;refactor this code&quot;, &quot;remove this feature&quot;, &quot;add this new feature&quot;. While sometimes this works well, especially for smaller changes or codebases, it often falls apart on complex changes.</p>
<p><strong><a href="https://github.com/humanlayer/advanced-context-engineering-for-coding-agents/blob/main/ace-fca.md" target="_blank" rel="noopener noreferrer" class="">RPI (Research, Plan, Implement)</a></strong>, introduced by HumanLayer, proposes a different way of working with AI agents. This approach trades speed for clarity, predictability, and correctness.</p>
<p>This tutorial walks through how RPI works via a real demonstration. By the end, you should be able to run this same workflow on your own codebase.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>1. Import RPI Recipes</summary><div><div class="collapsibleContent_i85q"><p>Copy the snippet below and paste it in your terminal. This will download the main RPI recipes and their subrecipes and save them into the global recipe directory.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/.config/goose/recipes/subrecipes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/rpi-research.yaml -o ~/.config/goose/recipes/rpi-research.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/rpi-plan.yaml -o ~/.config/goose/recipes/rpi-plan.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/rpi-implement.yaml -o ~/.config/goose/recipes/rpi-implement.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/rpi-iterate.yaml -o ~/.config/goose/recipes/rpi-iterate.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/subrecipes/rpi-codebase-locator.yaml -o ~/.config/goose/recipes/subrecipes/rpi-codebase-locator.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/subrecipes/rpi-codebase-analyzer.yaml -o ~/.config/goose/recipes/subrecipes/rpi-codebase-analyzer.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sL https://raw.githubusercontent.com/block/goose/main/documentation/src/pages/recipes/data/recipes/subrecipes/rpi-pattern-finder.yaml -o ~/.config/goose/recipes/subrecipes/rpi-pattern-finder.yaml</span><br></span></code></pre></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>2. Add Custom Slash Commands</summary><div><div class="collapsibleContent_i85q"><p>Now that the recipes are imported, to quickly invoke them in-session <a class="" href="/goose/docs/guides/context-engineering/slash-commands">add custom slash commands</a> for each of the following recipes:</p><table><thead><tr><th>Recipe</th><th>Slash Command</th></tr></thead><tbody><tr><td>RPI Research Codebase</td><td><code>research</code></td></tr><tr><td>RPI Create Plan</td><td><code>plan</code></td></tr><tr><td>RPI Implement Plan</td><td><code>implement</code></td></tr><tr><td>RPI Iterate</td><td><code>iterate</code></td></tr></tbody></table></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rpi-workflow">RPI Workflow<a href="#rpi-workflow" class="hash-link" aria-label="Direct link to RPI Workflow" title="Direct link to RPI Workflow" translate="no">​</a></h2>
<p>In goose, we use a structured RPI workflow using recipes to systematically tackle complex codebase changes. The workflow consists of slash commands that guide goose through disciplined phases of work:</p>
<ol>
<li class=""><code>research</code> – Document what exists today. No opinions.</li>
<li class=""><code>plan</code> - Design the change with clear phases and success criteria.</li>
<li class=""><code>implement</code> - Execute the plan step by step with verification.</li>
<li class=""><code>iterate</code> – (optional) Adjust the plan if necessary.</li>
</ol>
<div class="language-md codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-md codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────-┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                           RPI WORKFLOW                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────────────────-┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  /research &quot;topic&quot;                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Spawns parallel sub-agents:                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │    • find_files (rpi-codebase-locator)                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │    • analyze_code (rpi-codebase-analyzer)                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │    • find_patterns (rpi-pattern-finder)                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └──► Output: thoughts/research/YYYY-MM-DD-HHmm-topic.md                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  /plan &quot;feature/task&quot;                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Reads research docs                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Asks clarifying questions                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Proposes design options                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └──► Output: thoughts/plans/YYYY-MM-DD-HHmm-description.md             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  /implement &quot;plan path&quot;                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Executes phase by phase                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Runs verification after each phase                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Updates checkboxes in plan                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └──► Working code                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  /iterate &quot;plan path&quot; + feedback                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Researches only what changed                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├──► Updates the plan surgically                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └──► Updated plan                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────────────────-┘</span><br></span></code></pre></div></div>
<p>All RPI outputs live in a predictable place:</p>
<div class="language-md codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-md codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">thoughts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── research/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── YYYY-MM-DD-HHmm-topic.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── plans/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── YYYY-MM-DD-HHmm-description.md</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-task">The Task<a href="#the-task" class="hash-link" aria-label="Direct link to The Task" title="Direct link to The Task" translate="no">​</a></h2>
<p>In this tutorial, I want to remove an existing feature from a large codebase.</p>
<p>This isn&#x27;t a small change. The feature touches:</p>
<ul>
<li class="">Core Rust code</li>
<li class="">TypeScript</li>
<li class="">Configuration</li>
<li class="">Tests</li>
<li class="">Documentation</li>
</ul>
<p>This is the kind of task where agents often struggle, not because they&#x27;re incapable, but because the work spans too much context to safely &quot;just do it.&quot;</p>
<p>So instead of jumping to implementation, we&#x27;ll use RPI.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="session-1-research">Session 1: Research<a href="#session-1-research" class="hash-link" aria-label="Direct link to Session 1: Research" title="Direct link to Session 1: Research" translate="no">​</a></h2>
<p>The concept of planning before implementation has become a widely accepted practice. However, planning without research can lead to assumptions that come back to bite you. So, in RPI, we begin with research.</p>
<p>I start the prompt with the <code>/research</code> command followed by a topic written in natural language</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/research &quot;look through the cloned goose repo and research how the LLM Tool Discovery is implemented&quot;</span><br></span></code></pre></div></div>
<p>This command invokes the <strong><a href="https://raw.githubusercontent.com/block/goose/refs/heads/main/documentation/src/pages/recipes/data/recipes/rpi-research.yaml" target="_blank" rel="noopener noreferrer" class="">RPI Research Codebase</a></strong> recipe, whose job is very strict:</p>
<ul>
<li class="">Document what exists</li>
<li class="">Do not suggest changes</li>
<li class="">Do not critique</li>
<li class="">Do not plan</li>
</ul>
<p>With this recipe, goose automatically spawns three parallel subagents:</p>
<ul>
<li class=""><code>find_files</code>: Uses the codebase locator to figure out where relevant files live.</li>
<li class=""><code>analyze_code</code>: Reads those files fully and documents how they work.</li>
<li class=""><code>find_patterns</code>: Looks for similar features or conventions elsewhere in the repo.</li>
</ul>
<p>These subagents run independently and report back. You don&#x27;t have to orchestrate that yourself.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>A course correction</div><div class="admonitionContent_BuS1"><p>After goose began researching, I noticed that it was researching &quot;tool discovery&quot; in general. But I only wanted to remove a specific feature called Tool Selection Strategy. So I stopped goose and reran research with a more accurate topic.</p><p>That wasn&#x27;t a failure. In fact, this is exactly why research exists. Had I told goose to &quot;remove the LLM Tool Discovery feature&quot;, it may have removed our other tool discovery methods as well. Fortunately, catching these types of mistakes early is cheap and easy to recover from.</p></div></div>
<p>The output from the <code>/research</code> session was a detailed research document:</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>./thoughts/research/2025-12-22-llm-tool-selection-strategy.md</summary><div><div class="collapsibleContent_i85q"><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token front-matter-block punctuation" style="color:#393A34">---</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml datetime number" style="color:#36acaa">2025-12-22T23:43:05-06:00</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">git_commit</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> 2f876725d3c08f821358e1391a7daadf468193d8</span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">branch</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> remove</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">-</span><span class="token front-matter-block front-matter yaml language-yaml">llm</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">-</span><span class="token front-matter-block front-matter yaml language-yaml">tool</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">-</span><span class="token front-matter-block front-matter yaml language-yaml">discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">repository</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> goose</span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">topic</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml string" style="color:#e3116c">&quot;LLM Tool Selection Strategy (Tool Discovery Feature)&quot;</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">tags</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">[</span><span class="token front-matter-block front-matter yaml language-yaml">research</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">,</span><span class="token front-matter-block front-matter yaml language-yaml"> codebase</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">,</span><span class="token front-matter-block front-matter yaml language-yaml"> tools</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">,</span><span class="token front-matter-block front-matter yaml language-yaml"> router</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">,</span><span class="token front-matter-block front-matter yaml language-yaml"> llm</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">-</span><span class="token front-matter-block front-matter yaml language-yaml">selection</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">,</span><span class="token front-matter-block front-matter yaml language-yaml"> experimental</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">]</span><span class="token front-matter-block front-matter yaml language-yaml"></span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule" style="color:#00a4db">status</span><span class="token front-matter-block front-matter yaml language-yaml punctuation" style="color:#393A34">:</span><span class="token front-matter-block front-matter yaml language-yaml"> complete</span><span class="token front-matter-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Research: LLM Tool Selection Strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Research Question</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">How is the &quot;Tool Selection Strategy&quot; feature implemented? This is the experimental feature that uses &quot;LLM-based intelligence to select the most relevant tools based on the user query context.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Summary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Tool Selection Strategy</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"> is an experimental feature (preview) that dynamically filters which tools are presented to the LLM based on the user&#x27;s query. Instead of sending all tools from all extensions to the LLM, it:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> Provides a single </span><span class="token code-snippet code keyword" style="color:#00009f">`router__llm_search`</span><span class="token plain"> tool to the main LLM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> When invoked, uses a secondary LLM call to search indexed tools and return only relevant ones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> Tracks recently used tools to include them automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This saves context window space when many extensions are enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Configuration</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> (boolean, default: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Detailed Findings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 1. Feature Toggle - Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The feature is controlled by the </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> config parameter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_route_manager.rs:79-86`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">pub async fn is_router_enabled(&amp;self) -&gt; bool {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    if *self.router_disabled_override.lock().await {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    let config = Config::global();</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    if let Ok(config_value) = config.get_param::&lt;String&gt;(&quot;GOOSE_ENABLE_ROUTER&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        return config_value.to_lowercase() == &quot;true&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    // Default to false if neither is set</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    false</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">UI Toggle: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`ui/desktop/src/components/settings/tool_selection_strategy/ToolSelectionStrategySection.tsx`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Displays &quot;Disabled&quot; (default) and &quot;Enabled&quot; radio options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Updates </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> config via upsert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Calls </span><span class="token code-snippet code keyword" style="color:#00009f">`/agent/update_router_tool_selector`</span><span class="token plain"> endpoint to reinitialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 2. Core Components</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2.1 ToolRouteManager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_route_manager.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Central manager that:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Holds the </span><span class="token code-snippet code keyword" style="color:#00009f">`RouterToolSelector`</span><span class="token plain"> instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Checks if router is enabled/functional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Dispatches search tool calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Provides tools for router mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">pub struct ToolRouteManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    router_tool_selector: Mutex&lt;Option&lt;Arc&lt;Box&lt;dyn RouterToolSelector&gt;&gt;&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    router_disabled_override: Mutex&lt;bool&gt;,  // For recipes that need all tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key methods:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`is_router_enabled()`</span><span class="token plain"> - Checks config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`is_router_functional()`</span><span class="token plain"> - Enabled AND selector initialized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`dispatch_route_search_tool()`</span><span class="token plain"> - Handles </span><span class="token code-snippet code keyword" style="color:#00009f">`router__llm_search`</span><span class="token plain"> calls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`list_tools_for_router()`</span><span class="token plain"> - Returns search tool + recently used tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2.2 RouterToolSelector Trait &amp; LLMToolSelector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tool_selector.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">#[async_trait]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub trait RouterToolSelector: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    async fn select_tools(&amp;self, params: JsonObject) -&gt; Result&lt;Vec&lt;Content&gt;, ErrorData&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    async fn index_tools(&amp;self, tools: &amp;[Tool], extension_name: &amp;str) -&gt; Result&lt;(), ErrorData&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    async fn remove_tool(&amp;self, tool_name: &amp;str) -&gt; Result&lt;(), ErrorData&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    async fn record_tool_call(&amp;self, tool_name: &amp;str) -&gt; Result&lt;(), ErrorData&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    async fn get_recent_tool_calls(&amp;self, limit: usize) -&gt; Result&lt;Vec&lt;String&gt;, ErrorData&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">LLMToolSelector</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"> implementation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Stores tool strings indexed by extension name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Uses an LLM provider to search tools based on query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Tracks last 100 tool calls for &quot;recently used&quot; feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2.3 The Search Tool Definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tools.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">pub const ROUTER_LLM_SEARCH_TOOL_NAME: &amp;str = &quot;router__llm_search&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub fn llm_search_tool() -&gt; Tool {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    Tool::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        ROUTER_LLM_SEARCH_TOOL_NAME.to_string(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        r#&quot;Searches for relevant tools based on the user&#x27;s messages.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        Format a query to search for the most relevant tools...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        Extension name is not optional, it is required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        The returned result will be a list of tool names, descriptions, and schemas...&quot;#,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        // Schema requires: extension_name (string), query (string), optional k (integer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2.4 Tool Indexing Manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_router_index_manager.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Handles indexing/removing tools when extensions are added/removed:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">impl ToolRouterIndexManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    pub async fn update_extension_tools(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        selector: &amp;Arc&lt;Box&lt;dyn RouterToolSelector&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        extension_manager: &amp;ExtensionManager,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        extension_name: &amp;str,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        action: &amp;str,  // &quot;add&quot; or &quot;remove&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ) -&gt; Result&lt;()&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 3. Flow: How Tool Selection Works</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                    INITIALIZATION                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 1. User enables &quot;Tool Selection Strategy&quot; in settings           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 2. GOOSE_ENABLE_ROUTER = &quot;true&quot; saved to config                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 3. /agent/update_router_tool_selector called                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 4. ToolRouteManager.update_router_tool_selector():              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│    a. Creates LLMToolSelector with provider                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│    b. Indexes all tools from all enabled extensions             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│    c. Stores selector in router_tool_selector mutex             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">└─────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                    TOOL LISTING (Router Mode)                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ When agent.list_tools() is called with router enabled:          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ Instead of returning ALL tools, returns:                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   1. router__llm_search tool                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   2. Recently used tools (last 20 calls)                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   3. Platform tools (extension manager, etc.)                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ This dramatically reduces context sent to LLM                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">└─────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                    RUNTIME: User Query                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 1. User: &quot;list files in current directory&quot;                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 2. LLM sees router__llm_search tool in available tools          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ 3. LLM invokes: router__llm_search(                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│      extension_name: &quot;developer&quot;,                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│      query: &quot;list files directory&quot;                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│    )                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">└─────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                    SEARCH EXECUTION                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ Agent.dispatch_tool_call() routes to:                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   ToolRouteManager.dispatch_route_search_tool()                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│     → LLMToolSelector.select_tools()                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ LLMToolSelector:                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   1. Gets indexed tool strings for extension                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   2. Renders router_tool_selector.md prompt template            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   3. Calls LLM provider with tool list + query                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   4. Parses response for &quot;Tool: X\nDescription: Y\nSchema: Z&quot;   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│   5. Returns matching tools as Content                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">└─────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">                              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│                    LLM RECEIVES RESULTS                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ Main LLM receives tool definitions in response                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ Can now invoke the actual tool (e.g., developer__shell)         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">│ Tool call is recorded for &quot;recently used&quot; feature               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block">└─────────────────────────────────────────────────────────────────┘</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 4. System Prompt Integration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/prompt_manager.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">When router is enabled, the system prompt includes special instructions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">tool_selection_strategy: self.router_enabled.then(llm_search_tool_prompt),</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tools.rs:41-57`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">pub fn llm_search_tool_prompt() -&gt; String {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    format!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        r#&quot;# LLM Tool Selection Instructions</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    Important: the user has opted to dynamically enable tools, so although an extension could be enabled, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    please invoke the llm search tool to actually retrieve the most relevant tools to use according to the user&#x27;s messages.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    By dynamically enabling tools, you (goose) as the agent save context window space and allow the user to dynamically retrieve the most relevant tools.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &quot;#,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        // Lists platform extension tools that are always available</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is injected into </span><span class="token code-snippet code keyword" style="color:#00009f">`system.md`</span><span class="token plain"> via </span><span class="token code-snippet code keyword" style="color:#00009f">`{{tool_selection_strategy}}`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 5. LLM Search Prompt Template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/prompts/router_tool_selector.md`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">markdown</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-markdown">You are a tool selection assistant. Your task is to find the most relevant tools based on the user&#x27;s query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Given the following tools:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">{{ tools }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Find the most relevant tools for the query: {{ query }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Return the tools in this exact format for each tool:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Tool: &lt;tool_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Description: &lt;tool_description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">Schema: &lt;tool_schema&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 6. Server Endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose-server/src/routes/agent.rs`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">#[utoipa::path(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    post,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    path = &quot;/agent/update_router_tool_selector&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">async fn update_router_tool_selector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    State(state): State&lt;Arc&lt;AppState&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    Json(payload): Json&lt;UpdateRouterToolSelectorRequest&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">) -&gt; Result&lt;Json&lt;String&gt;, StatusCode&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    let agent = state.get_agent_for_route(payload.session_id).await?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .update_router_tool_selector(None, Some(true))  // reindex_all = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .await</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .map_err(...)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    Ok(Json(&quot;Tool selection strategy updated successfully&quot;.to_string()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 7. Recipe Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recipes can disable the router to ensure all tools are available:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File: </span><span class="token bold content code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_route_manager.rs:31-34`</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">pub async fn disable_router_for_recipe(&amp;self) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    *self.router_disabled_override.lock().await = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    *self.router_tool_selector.lock().await = None;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Code References</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Core Implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_route_manager.rs`</span><span class="token plain"> - Main manager, config check, dispatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tool_selector.rs`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`RouterToolSelector`</span><span class="token plain"> trait, </span><span class="token code-snippet code keyword" style="color:#00009f">`LLMToolSelector`</span><span class="token plain"> impl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tools.rs`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`router__llm_search`</span><span class="token plain"> tool definition, prompt function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_router_index_manager.rs`</span><span class="token plain"> - Tool indexing on extension add/remove</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Integration Points</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/agent.rs`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`dispatch_tool_call()`</span><span class="token plain"> routes </span><span class="token code-snippet code keyword" style="color:#00009f">`ROUTER_LLM_SEARCH_TOOL_NAME`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/prompt_manager.rs`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`with_router_enabled()`</span><span class="token plain">, injects prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose-server/src/routes/agent.rs`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`/agent/update_router_tool_selector`</span><span class="token plain"> endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`ui/desktop/src/components/settings/tool_selection_strategy/ToolSelectionStrategySection.tsx`</span><span class="token plain"> - Settings toggle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Prompts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/prompts/router_tool_selector.md`</span><span class="token plain"> - LLM search prompt template</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/prompts/system.md`</span><span class="token plain"> - </span><span class="token code-snippet code keyword" style="color:#00009f">`{{tool_selection_strategy}}`</span><span class="token plain"> placeholder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Key Design Patterns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Two-stage LLM calls</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Main LLM calls search tool → Search LLM finds relevant tools → Main LLM uses them</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Extension-based indexing</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Tools indexed by extension name for filtered searches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Recently used caching</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Last 20 tool calls automatically included (no search needed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Override mechanism</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Recipes can disable router to get all tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">5.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Lazy initialization</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Selector only created when enabled AND provider available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Limitations Noted in UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> &quot;Only tested with Claude models currently&quot; (from UI description)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Experimental/preview feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Open Questions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Performance</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: What&#x27;s the latency impact of the secondary LLM call for tool search?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Accuracy</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: How well does the search LLM match tools to queries in practice?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Token savings</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: What&#x27;s the actual context window savings for typical extension counts?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">4.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Model compatibility</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Why only tested with Claude? What breaks with other models?</span><br></span></code></pre></div></div></div></div></details>
<p>This is a large, structured file that includes:</p>
<ul>
<li class="">Git metadata</li>
<li class="">File and line references</li>
<li class="">Flow descriptions</li>
<li class="">Key components</li>
<li class="">Open questions</li>
</ul>
<p>Think of it as a technical map of the feature as it exists today. Nothing was changed yet, and that&#x27;s intentional. The only goal was shared understanding.</p>
<p>As the human in the loop, be sure to review the research! This will inform the plan, so you want to make sure this is accurate.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="session-2-plan">Session 2: Plan<a href="#session-2-plan" class="hash-link" aria-label="Direct link to Session 2: Plan" title="Direct link to Session 2: Plan" translate="no">​</a></h2>
<p>Once research is complete, you move to planning.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Sessions</div><div class="admonitionContent_BuS1"><p>It&#x27;s important to do each phase in a new session to keep the LLM laser focused on only the task at hand. One goal per session!</p></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/plan a removal of the Tool Selection Strategy feature</span><br></span></code></pre></div></div>
<p>The <strong><a href="https://raw.githubusercontent.com/block/goose/refs/heads/main/documentation/src/pages/recipes/data/recipes/rpi-plan.yaml" target="_blank" rel="noopener noreferrer" class="">RPI Create Plan</a></strong> recipe starts by reading the research document goose created.</p>
<p>Then it did three key things:</p>
<ol>
<li class="">
<p>Asked clarifying questions
For example:</p>
<ul>
<li class="">Full removal vs deprecation?</li>
<li class="">How should config cleanup behave?</li>
<li class="">Should OpenAPI artifacts be regenerated?</li>
<li class="">Where do related tests live?</li>
</ul>
</li>
<li class="">
<p>Presented design options
Where there were multiple reasonable approaches, goose laid them out and asked me to choose.</p>
</li>
<li class="">
<p>Produced a phased implementation plan</p>
</li>
</ol>
<p>The output was a detailed plan:</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>thoughts/plans/2025-12-23-remove-tool-selection-strategy.md</summary><div><div class="collapsibleContent_i85q"><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> Remove Tool Selection Strategy Feature - Implementation Plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Complete removal of the &quot;Tool Selection Strategy&quot; feature (also known as &quot;LLM Tool Router&quot; or &quot;Smart Tool Routing&quot;). This experimental feature used a secondary LLM call to dynamically select which tools to present to the main LLM based on the user&#x27;s query.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Current State Analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The feature is controlled by </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> config parameter (default: false). It consists of:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Core implementation files (4 Rust modules + 1 prompt template)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Integration points in agent, prompt manager, and server routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> UI settings section in desktop app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> CLI configuration dialog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Documentation pages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Key Discoveries:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Feature is disabled by default and marked as &quot;experimental/preview&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Only tested with Claude models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Has telemetry tracking in posthog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Snapshot tests in </span><span class="token code-snippet code keyword" style="color:#00009f">`prompt_manager.rs`</span><span class="token plain"> use </span><span class="token code-snippet code keyword" style="color:#00009f">`.with_router_enabled(true)`</span><span class="token plain"> and will need updating</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`agent.rs`</span><span class="token plain"> test references </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> but only for context setup, not testing router functionality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Desired End State</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> All Tool Selection Strategy code removed from codebase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> No </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> config handling (ignored if present in user config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> No </span><span class="token code-snippet code keyword" style="color:#00009f">`router__llm_search`</span><span class="token plain"> tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> No </span><span class="token code-snippet code keyword" style="color:#00009f">`/agent/update_router_tool_selector`</span><span class="token plain"> API endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> No UI settings for tool selection strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> No CLI configuration for router strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Documentation removed/updated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> All tests pass, linting passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> What We&#x27;re NOT Doing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Cleaning up existing </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> entries from user config files (will be ignored)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Adding deprecation warnings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Keeping any stub code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Implementation Approach</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove in dependency order: core files first, then integration points, then UI/CLI, then documentation. This minimizes compilation errors during the process.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 1: Remove Core Implementation Files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Delete the core Rust modules that implement the router functionality.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Delete core router files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Files to delete:</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tool_selector.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/router_tools.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_route_manager.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/tool_router_index_manager.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/prompts/router_tool_selector.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update module declarations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/mod.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove module declarations for deleted files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE these lines:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">mod router_tool_selector;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">mod router_tools;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">mod tool_route_manager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">mod tool_router_index_manager;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] Files deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose`</span><span class="token plain"> compiles (will fail until Phase 2 completes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Implementation Note</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Phase 1 will cause compilation errors. Proceed immediately to Phase 2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 2: Update Agent Integration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove all router-related code from </span><span class="token code-snippet code keyword" style="color:#00009f">`agent.rs`</span><span class="token plain"> and related files.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update agent.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/agent.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove imports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">use crate::agents::router_tools::ROUTER_LLM_SEARCH_TOOL_NAME;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">use crate::agents::tool_route_manager::ToolRouteManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">use crate::agents::tool_router_index_manager::ToolRouterIndexManager;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from Agent struct:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE field:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub tool_route_manager: Arc&lt;ToolRouteManager&gt;,</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from Agent::new():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">tool_route_manager: Arc::new(ToolRouteManager::new()),</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove method </span><span class="token code-snippet code keyword" style="color:#00009f">`disable_router_for_recipe`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub async fn disable_router_for_recipe(&amp;self) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    self.tool_route_manager.disable_router_for_recipe().await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`dispatch_tool_call`</span><span class="token plain"> - the </span><span class="token code-snippet code keyword" style="color:#00009f">`ROUTER_LLM_SEARCH_TOOL_NAME`</span><span class="token plain"> branch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE this else-if branch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">} else if tool_call.name == ROUTER_LLM_SEARCH_TOOL_NAME {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    match self</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .tool_route_manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .dispatch_route_search_tool(tool_call.arguments.unwrap_or_default())</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .await</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        Ok(tool_result) =&gt; tool_result,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        Err(e) =&gt; return (request_id, Err(e)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`add_extension`</span><span class="token plain"> - the router indexing logic:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE this block:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">// If LLM tool selection is functional, index the tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">if self.tool_route_manager.is_router_functional().await {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    let selector = self.tool_route_manager.get_router_tool_selector().await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    if let Some(selector) = selector {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        let selector = Arc::new(selector);</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        if let Err(e) = ToolRouterIndexManager::update_extension_tools(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &amp;selector,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &amp;self.extension_manager,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &amp;extension.name(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &quot;add&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .await</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            return Err(ExtensionError::SetupError(format!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">                &quot;Failed to index tools for extension {}: {}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">                extension.name(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">                e</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove </span><span class="token code-snippet code keyword" style="color:#00009f">`list_tools_for_router`</span><span class="token plain"> method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub async fn list_tools_for_router(&amp;self) -&gt; Vec&lt;Tool&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`remove_extension`</span><span class="token plain"> - the router de-indexing logic:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE this block:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">// If LLM tool selection is functional, remove tools from the index</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">if self.tool_route_manager.is_router_functional().await {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    let selector = self.tool_route_manager.get_router_tool_selector().await;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    if let Some(selector) = selector {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        ToolRouterIndexManager::update_extension_tools(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &amp;selector,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &amp;self.extension_manager,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">            &quot;remove&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .await?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove </span><span class="token code-snippet code keyword" style="color:#00009f">`update_router_tool_selector`</span><span class="token plain"> method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub async fn update_router_tool_selector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    provider: Option&lt;Arc&lt;dyn Provider&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    reindex_all: Option&lt;bool&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">) -&gt; Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`reply_internal`</span><span class="token plain"> stream - the </span><span class="token code-snippet code keyword" style="color:#00009f">`record_tool_requests`</span><span class="token plain"> call:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">self.tool_route_manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    .record_tool_requests(&amp;requests_to_record)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    .await;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update extension.rs (PlatformExtensionContext)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/extension.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> field from </span><span class="token code-snippet code keyword" style="color:#00009f">`PlatformExtensionContext`</span><span class="token plain"> if present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Search for any references to </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> in this file and remove them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 3. Update extension_manager_extension.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/extension_manager_extension.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove any references to </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose`</span><span class="token plain"> compiles (may still fail until Phase 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 3: Update Prompt Manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove router-related prompt building logic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update prompt_manager.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/prompt_manager.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove import:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">use crate::agents::router_tools::llm_search_tool_prompt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`SystemPromptContext`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE field:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">#[serde(skip_serializing_if = &quot;Option::is_none&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">tool_selection_strategy: Option&lt;String&gt;,</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from </span><span class="token code-snippet code keyword" style="color:#00009f">`SystemPromptBuilder`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE field:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">router_enabled: bool,</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove </span><span class="token code-snippet code keyword" style="color:#00009f">`with_router_enabled`</span><span class="token plain"> method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire method:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub fn with_router_enabled(mut self, enabled: bool) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    self.router_enabled = enabled;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    self</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Update </span><span class="token code-snippet code keyword" style="color:#00009f">`build`</span><span class="token plain"> method - remove router_enabled from context:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE from SystemPromptContext construction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">tool_selection_strategy: self.router_enabled.then(llm_search_tool_prompt),</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Update builder initialization:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE from SystemPromptBuilder initialization:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">router_enabled: false,</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update system.md template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/prompts/system.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove the </span><span class="token code-snippet code keyword" style="color:#00009f">`{{tool_selection_strategy}}`</span><span class="token plain"> placeholder line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">markdown</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-markdown">&lt;!-- REMOVE this line: --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">{{tool_selection_strategy}}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 3. Update snapshot tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/prompt_manager.rs`</span><span class="token plain"> (tests section)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove </span><span class="token code-snippet code keyword" style="color:#00009f">`.with_router_enabled(true)`</span><span class="token plain"> from tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In </span><span class="token code-snippet code keyword" style="color:#00009f">`test_one_extension`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">.with_router_enabled(true)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In </span><span class="token code-snippet code keyword" style="color:#00009f">`test_typical_setup`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">.with_router_enabled(true)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 4. Update/regenerate snapshots</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Files to update:</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/snapshots/goose__agents__prompt_manager__tests__one_extension.snap`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/agents/snapshots/goose__agents__prompt_manager__tests__typical_setup.snap`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test -p goose prompt_manager`</span><span class="token plain"> with </span><span class="token code-snippet code keyword" style="color:#00009f">`INSTA_UPDATE=1`</span><span class="token plain"> to regenerate snapshots, or manually remove the &quot;LLM Tool Selection Instructions&quot; section from each snapshot.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose`</span><span class="token plain"> compiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test -p goose`</span><span class="token plain"> passes (after snapshot updates)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 4: Update Server Routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the </span><span class="token code-snippet code keyword" style="color:#00009f">`/agent/update_router_tool_selector`</span><span class="token plain"> endpoint.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update agent.rs routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose-server/src/routes/agent.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove request struct:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">#[derive(Deserialize, utoipa::ToSchema)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub struct UpdateRouterToolSelectorRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    session_id: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove handler function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">#[utoipa::path(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    post,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    path = &quot;/agent/update_router_tool_selector&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">async fn update_router_tool_selector(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">) -&gt; Result&lt;Json&lt;String&gt;, StatusCode&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove route from router:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE from routes() function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">.route(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &quot;/agent/update_router_tool_selector&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    post(update_router_tool_selector),</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose-server`</span><span class="token plain"> compiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test -p goose-server`</span><span class="token plain"> passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 5: Update CLI Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the router configuration dialog from CLI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update configure.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose-cli/src/commands/configure.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the router strategy menu item from </span><span class="token code-snippet code keyword" style="color:#00009f">`configure_settings_dialog`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE this item:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">.item(</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &quot;goose_router_strategy&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &quot;Router Tool Selection Strategy&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    &quot;Experimental: configure a strategy for auto selecting tools to use&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">)</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the match arm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">&quot;goose_router_strategy&quot; =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    configure_goose_router_strategy_dialog()?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the entire </span><span class="token code-snippet code keyword" style="color:#00009f">`configure_goose_router_strategy_dialog`</span><span class="token plain"> function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE entire function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">pub fn configure_goose_router_strategy_dialog() -&gt; anyhow::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose-cli`</span><span class="token plain"> compiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test -p goose-cli`</span><span class="token plain"> passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 6: Update Telemetry ✅ COMPLETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove router-related telemetry.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update posthog.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/src/posthog.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the router telemetry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE this block:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">if let Ok(router_enabled) = config.get_param::&lt;bool&gt;(&quot;GOOSE_ENABLE_ROUTER&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">    event</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .insert_prop(&quot;setting_router_enabled&quot;, router_enabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">        .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build -p goose`</span><span class="token plain"> compiles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 7: Update Desktop UI ✅ COMPLETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the Tool Selection Strategy settings section from the desktop app.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Delete UI component directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Directory to delete</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`ui/desktop/src/components/settings/tool_selection_strategy/`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update ChatSettingsSection.tsx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`ui/desktop/src/components/settings/chat/ChatSettingsSection.tsx`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove import:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-typescript">// REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-typescript">import { ToolSelectionStrategySection } from &#x27;../tool_selection_strategy/ToolSelectionStrategySection&#x27;;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the Card containing ToolSelectionStrategySection:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">tsx</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-tsx">{/* REMOVE entire Card: */}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">&lt;Card className=&quot;pb-2 rounded-lg&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  &lt;CardHeader className=&quot;pb-0&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">    &lt;CardTitle className=&quot;&quot;&gt;Tool Selection Strategy (preview)&lt;/CardTitle&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">    &lt;CardDescription&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">      Experimental: configure how Goose selects tools for your requests, useful when there are</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">      many tools. Only tested with Claude models currently.</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">    &lt;/CardDescription&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  &lt;/CardHeader&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  &lt;CardContent className=&quot;px-2&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">    &lt;ToolSelectionStrategySection /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  &lt;/CardContent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">&lt;/Card&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 3. Regenerate OpenAPI types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run: </span><span class="token code-snippet code keyword" style="color:#00009f">`just generate-openapi`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This will update </span><span class="token code-snippet code keyword" style="color:#00009f">`ui/desktop/openapi.json`</span><span class="token plain"> and </span><span class="token code-snippet code keyword" style="color:#00009f">`ui/desktop/src/api/types.gen.ts`</span><span class="token plain"> to remove the </span><span class="token code-snippet code keyword" style="color:#00009f">`UpdateRouterToolSelectorRequest`</span><span class="token plain"> type.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cd ui/desktop &amp;&amp; npm run lint`</span><span class="token plain"> passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cd ui/desktop &amp;&amp; npm run typecheck`</span><span class="token plain"> passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] OpenAPI types regenerated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Manual Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] Desktop app Settings &gt; Chat page loads without errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] No &quot;Tool Selection Strategy&quot; section visible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 8: Update Documentation ✅ COMPLETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove documentation for the removed feature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Delete tool-router.md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File to delete</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`documentation/docs/guides/managing-tools/tool-router.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update managing-tools index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`documentation/docs/guides/managing-tools/index.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the Tool Selection Strategy card:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">tsx</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-tsx">{/* REMOVE: */}</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">&lt;Card </span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  title=&quot;Tool Selection Strategy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  description=&quot;Optimize tool selection with dynamic routing that loads only the tools you need, reducing context overhead and improving performance.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">  link=&quot;/docs/guides/managing-tools/tool-router&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-tsx">/&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 3. Update environment-variables.md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`documentation/docs/guides/environment-variables.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove the </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER`</span><span class="token plain"> row from the table:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">markdown</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-markdown">&lt;!-- REMOVE this row: --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-markdown">| `GOOSE_ENABLE_ROUTER` | Enables [intelligent tool selection strategy](/docs/guides/managing-tools/tool-router) | &quot;true&quot;, &quot;false&quot; | &quot;false&quot; |</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Remove from the example section:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">bash</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-bash"># REMOVE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash"># Enable intelligent tool selection</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">export GOOSE_ENABLE_ROUTER=true</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 4. Check for other documentation references</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Search for any other references to &quot;tool selection&quot;, &quot;router&quot;, or &quot;GOOSE_ENABLE_ROUTER&quot; in documentation and remove them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] No remaining references to GOOSE_ENABLE_ROUTER in documentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Manual Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] No references to Tool Selection Strategy in docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 9: Update Tests ✅ COMPLETE (merged into earlier phases)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Update any remaining tests that reference the removed functionality.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Update agent.rs tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">File</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: </span><span class="token code-snippet code keyword" style="color:#00009f">`crates/goose/tests/agent.rs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Changes</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In </span><span class="token code-snippet code keyword" style="color:#00009f">`extension_manager_tests::setup_agent_with_extension_manager`</span><span class="token plain">, remove the </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> from context setup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">rust</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-rust">// REMOVE from PlatformExtensionContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-rust">tool_route_manager: Some(Arc::downgrade(&amp;agent.tool_route_manager)),</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Update PlatformExtensionContext references</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Search for any other test files that set up </span><span class="token code-snippet code keyword" style="color:#00009f">`PlatformExtensionContext`</span><span class="token plain"> with </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> and remove that field.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test`</span><span class="token plain"> passes for all crates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`./scripts/clippy-lint.sh`</span><span class="token plain"> passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Phase 10: Final Cleanup and Verification ✅ COMPLETE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Overview</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Final verification that all changes are complete and correct.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Changes Required:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 1. Search for any remaining references</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run these searches to ensure nothing was missed:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">bash</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-bash">rg &quot;tool_route&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;router_tool&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;RouterToolSelector&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;ROUTER_LLM_SEARCH&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;llm_search_tool&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;GOOSE_ENABLE_ROUTER&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;tool_selection_strategy&quot; --type rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">rg &quot;ToolSelectionStrategy&quot; --type ts --type tsx</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 2. Run full test suite</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">bash</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-bash">cargo fmt</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">cargo build</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">cargo test</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">./scripts/clippy-lint.sh</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> 3. Run UI checks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token code code-language">bash</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code code-block language-bash">cd ui/desktop</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">npm run lint</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token code code-block language-bash">npm test</span><span class="token code"></span><br></span><span class="token-line" style="color:#393A34"><span class="token code"></span><span class="token code punctuation" style="color:#393A34">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Success Criteria:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Automated Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] All searches return no results (except in thoughts/research)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo fmt`</span><span class="token plain"> - no changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo build`</span><span class="token plain"> - succeeds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test`</span><span class="token plain"> - all tests pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] </span><span class="token code-snippet code keyword" style="color:#00009f">`./scripts/clippy-lint.sh`</span><span class="token plain"> - passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [x] UI lint/typecheck - passes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">####</span><span class="token title important"> Manual Verification:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] Start goose CLI - works normally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] Start goose desktop - works normally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] Settings page loads without errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> [ ] No console errors related to removed feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Testing Strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Unit Tests:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Snapshot tests in </span><span class="token code-snippet code keyword" style="color:#00009f">`prompt_manager.rs`</span><span class="token plain"> need regeneration (Phase 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Agent tests need </span><span class="token code-snippet code keyword" style="color:#00009f">`tool_route_manager`</span><span class="token plain"> references removed (Phase 9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Integration Tests:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Full </span><span class="token code-snippet code keyword" style="color:#00009f">`cargo test`</span><span class="token plain"> after all phases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Desktop app manual testing after Phase 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Regression Testing:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Ensure normal tool calling still works</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Ensure extension add/remove still works</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Ensure all goose modes (auto, approve, smart_approve, chat) still work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Rollback Plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If issues are discovered:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> Git revert the changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> The feature was disabled by default, so no user impact from keeping it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Notes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> The research document at </span><span class="token code-snippet code keyword" style="color:#00009f">`thoughts/research/2025-12-22-llm-tool-selection-strategy.md`</span><span class="token plain"> should be kept for historical reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> Users with </span><span class="token code-snippet code keyword" style="color:#00009f">`GOOSE_ENABLE_ROUTER=true`</span><span class="token plain"> in their config will simply have the setting ignored</span><br></span></code></pre></div></div></div></div></details>
<p>This plan includes:</p>
<ul>
<li class="">10 explicit phases</li>
<li class="">Exact file paths</li>
<li class="">Code snippets showing what to remove</li>
<li class="">Automated success criteria</li>
<li class="">Manual verification steps</li>
<li class="">Checkboxes for tracking progress</li>
</ul>
<p>At this point, the plan became the source of truth. The key shift here is that we&#x27;ve moved from understanding to decision making, but we&#x27;re still not touching code.</p>
<p>The plan is explicit enough that someone else could execute it. That&#x27;s not an accident. Remember that the implementation will be in a fresh new session, so the plan must have enough context to actually execute it.</p>
<p>Again, you as the human need to step in here to review the plan and make sure it&#x27;s solid. If there&#x27;s anything amiss, instead of starting over you can run the <strong><a href="https://raw.githubusercontent.com/block/goose/refs/heads/main/documentation/src/pages/recipes/data/recipes/rpi-iterate.yaml" target="_blank" rel="noopener noreferrer" class="">RPI Iterate Plan</a></strong> plan (<code>/iterate</code>) with details on what&#x27;s wrong. goose will then read the existing plan, research only what needs rethinking, propose targeted updates, and edit the plan accordingly.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="session-3-implement">Session 3: Implement<a href="#session-3-implement" class="hash-link" aria-label="Direct link to Session 3: Implement" title="Direct link to Session 3: Implement" translate="no">​</a></h2>
<p>Only after research and planning are complete should you move to implementation. Pass in the plan document.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/implement thoughts/plans/2025-12-23-remove-tool-selection-strategy.md</span><br></span></code></pre></div></div>
<p>The <strong><a href="https://raw.githubusercontent.com/block/goose/refs/heads/main/documentation/src/pages/recipes/data/recipes/rpi-implement.yaml" target="_blank" rel="noopener noreferrer" class="">RPI Implement Plan</a></strong> recipe is intentionally boring. In fact, I fell asleep while goose was running it. Implementation should feel mechanical. If it feels creative, something upstream is missing. But knowing that you have a rock solid plan, I advise you to go do something else with your time while goose works (unless there are manual steps in the plan).</p>
<p>It will read the plan completely, execute the phases in order, run verification after each phase, and update the checkboxes directly in the plan file as it goes.</p>
<p>That last bit was really helpful because my context window filled up partway through and goose was able to compact and pick up right where it left off because of the status updates in the plan.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="final-result">Final Result<a href="#final-result" class="hash-link" aria-label="Direct link to Final Result" title="Direct link to Final Result" translate="no">​</a></h2>
<p>For 10 phases of work that spanned 32 files, the Research phase took 9 minutes, the Plan phase took 4 minutes, and the Implement phase took 39 minutes. So in total, this took just shy of an hour... 52 minutes to be exact. This included goose working and testing as well as me answering questions.</p>
<p>Definitely not a fast process. BUT! When I put up <a href="https://github.com/block/goose/pull/6250" target="_blank" rel="noopener noreferrer" class="">this PR</a>, the build passed and the separate Code Review Agent didn&#x27;t have a single comment. That&#x27;s just how well done the work was.</p>
<p>Had I done this without AI, it would have likely taken me several hours of work as the feature was complex and deeply integrated. And had I had AI jump straight to implementation, I have no doubt it would have surely drifted and messed something up.</p>
<p>So while RPI is slower than having AI get right to work, the quality is top notch. A very worthy tradeoff.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-rpi">When to Use RPI<a href="#when-to-use-rpi" class="hash-link" aria-label="Direct link to When to Use RPI" title="Direct link to When to Use RPI" translate="no">​</a></h2>
<p>For basic tasks, RPI may be overkill. Especially because it&#x27;s not a quick process. However, if you need to do a complex task that spans multiple files, it&#x27;s a great choice.</p>
<p>You can use RPI for:</p>
<ul>
<li class="">Refactors</li>
<li class="">Migrations</li>
<li class="">Feature additions</li>
<li class="">Large upgrades</li>
<li class="">Incident cleanup</li>
<li class="">Documentation overhauls</li>
</ul>
<p>Try it for yourself!</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/goose/docs/tutorials/recipes-tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Recipes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/goose/docs/tutorials/subrecipes-in-parallel"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Subrecipes In Parallel</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#rpi-workflow" class="table-of-contents__link toc-highlight">RPI Workflow</a></li><li><a href="#the-task" class="table-of-contents__link toc-highlight">The Task</a></li><li><a href="#session-1-research" class="table-of-contents__link toc-highlight">Session 1: Research</a></li><li><a href="#session-2-plan" class="table-of-contents__link toc-highlight">Session 2: Plan</a></li><li><a href="#session-3-implement" class="table-of-contents__link toc-highlight">Session 3: Implement</a></li><li><a href="#final-result" class="table-of-contents__link toc-highlight">Final Result</a></li><li><a href="#when-to-use-rpi" class="table-of-contents__link toc-highlight">When to Use RPI</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Quick Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/docs/getting-started/installation">Install goose</a></li><li class="footer__item"><a class="footer__link-item" href="/goose/extensions">Extensions</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/community">Spotlight</a></li><li class="footer__item"><a href="https://discord.gg/goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/goose-oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/goose_oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter / X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/opensource.block.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">BlueSky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://njump.me/opensource@block.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">Nostr<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/goose/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/block/goose" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Block, Inc.</div></div></div></footer></div>
<script src="/goose/inkeepChatButton.js" type="module"></script>
<div id="inkeepSearchBar"></div>
<script>(()=>{const e=document.getElementById("inkeepSearchBar");new MutationObserver(t=>{const n=document.getElementById("inkeep");n&&n.appendChild(e)}).observe(document.documentElement,{attributes:!0})})()</script>
<script src="/goose/inkeepSearchBar.js" type="module"></script></body>
</html>